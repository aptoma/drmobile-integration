/**
 * almond 0.1.1 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/* Zepto v1.0rc1 - polyfill zepto event detect fx ajax form touch - zeptojs.com/license */

/*!
 * textFit.js
 *
 * Copyright 2011, Peter Rudolfsen
 */

/*!
 Lo-Dash 0.8.2 lodash.com/license
 Underscore.js 1.4.2 underscorejs.org/LICENSE
*/

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * Swiper.js
 * Copyright 2012 Peter Rudolfsen <peter@aptoma.com>
 */

/** @license MIT License (c) copyright B Cavalier & J Hann */

/**
 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */

/**
 * Alf - Aptoma Layout Framework
 *
 * @copyright 2012-2013 Aptoma AS aptoma.com
 * @author Peter Rudolfsen <peter@aptoma.com>
 */

var requirejs,require,define;(function(e){function a(e,t){var n=t&&t.split("/"),i=r.map,s=i&&i["*"]||{},o,u,a,f,l,c,h;if(e&&e.charAt(0)==="."&&t){n=n.slice(0,n.length-1),e=n.concat(e.split("/"));for(l=0;h=e[l];l++)if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))return!0;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((n||s)&&i){o=e.split("/");for(l=o.length;l>0;l-=1){u=o.slice(0,l).join("/");if(n)for(c=n.length;c>0;c-=1){a=i[n.slice(0,c).join("/")];if(a){a=a[u];if(a){f=a;break}}}f=f||s[u];if(f){o.splice(0,l,f),e=o.join("/");break}}}return e}function f(t,n){return function(){return u.apply(e,s.call(arguments,0).concat([t,n]))}}function l(e){return function(t){return a(t,e)}}function c(e){return function(n){t[e]=n}}function h(r){if(n.hasOwnProperty(r)){var s=n[r];delete n[r],i[r]=!0,o.apply(e,s)}if(!t.hasOwnProperty(r))throw new Error("No "+r);return t[r]}function p(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=a(e.slice(0,i),t),e=e.slice(i+1),r=h(n),r&&r.normalize?e=r.normalize(e,l(t)):e=a(e,t)):e=a(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function d(e){return function(){return r&&r.config&&r.config[e]||{}}}var t={},n={},r={},i={},s=[].slice,o,u;o=function(r,s,o,u){var a=[],l,v,m,g,y,b;u=u||r;if(typeof o=="function"){s=!s.length&&o.length?["require","exports","module"]:s;for(b=0;b<s.length;b++){y=p(s[b],u),m=y.f;if(m==="require")a[b]=f(r);else if(m==="exports")a[b]=t[r]={},l=!0;else if(m==="module")v=a[b]={id:r,uri:"",exports:t[r],config:d(r)};else if(t.hasOwnProperty(m)||n.hasOwnProperty(m))a[b]=h(m);else if(y.p)y.p.load(y.n,f(u,!0),c(m),{}),a[b]=t[m];else if(!i[m])throw new Error(r+" missing "+m)}g=o.apply(t[r],a);if(r)if(v&&v.exports!==e&&v.exports!==t[r])t[r]=v.exports;else if(g!==e||!l)t[r]=g}else r&&(t[r]=o)},requirejs=require=u=function(t,n,i,s){return typeof t=="string"?h(p(t,n).f):(t.splice||(r=t,n.splice?(t=n,n=i,i=null):t=e),n=n||function(){},s?o(e,t,n,i):setTimeout(function(){o(e,t,n,i)},15),u)},u.config=function(e){return r=e,u},define=function(e,t,r){t.splice||(r=t,t=[]),n[e]=[e,t,r]},define.amd={jQuery:!0}})(),define("requirejs",function(){}),function(e){String.prototype.trim===e&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===e&&(Array.prototype.reduce=function(t){if(this===void 0||this===null)throw new TypeError;var n=Object(this),r=n.length>>>0,i=0,s;if(typeof t!="function")throw new TypeError;if(r==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)s=arguments[1];else do{if(i in n){s=n[i++];break}if(++i>=r)throw new TypeError}while(!0);while(i<r)i in n&&(s=t.call(e,s,n[i],i,n)),i++;return s})}();var Zepto=function(){function C(e){return E.call(e)=="[object Function]"}function k(e){return e instanceof Object}function L(t){var n,r;if(E.call(t)!=="[object Object]")return!1;r=C(t.constructor)&&t.constructor.prototype;if(!r||!hasOwnProperty.call(r,"isPrototypeOf"))return!1;for(n in t);return n===e||hasOwnProperty.call(t,n)}function A(e){return e instanceof Array}function O(e){return typeof e.length=="number"}function M(t){return t.filter(function(t){return t!==e&&t!==null})}function _(e){return e.length>0?[].concat.apply([],e):e}function D(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function P(e){return e in a?a[e]:a[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function H(e,t){return typeof t=="number"&&!l[D(e)]?t+"px":t}function B(e){var t,n;return u[e]||(t=o.createElement(e),o.body.appendChild(t),n=f(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),n=="none"&&(n="block"),u[e]=n),u[e]}function j(t,r){return r===e?n(t):n(t).filter(r)}function F(e,t,n,r){return C(t)?t.call(e,n,r):t}function I(e,t,r){var i=e%2?t:t.parentNode;i?i.insertBefore(r,e?e==1?i.firstChild:e==2?t:null:t.nextSibling):n(r).remove()}function q(e,t){t(e);for(var n in e.childNodes)q(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=window.document,u={},a={},f=o.defaultView.getComputedStyle,l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},c=/^\s*<(\w+|!)[^>]*>/,h=[1,3,8,9,11],p=["after","prepend","before","append"],d=o.createElement("table"),v=o.createElement("tr"),m={tr:o.createElement("tbody"),tbody:d,thead:d,tfoot:d,td:v,th:v,"*":o.createElement("div")},g=/complete|loaded|interactive/,y=/^\.([\w-]+)$/,b=/^#([\w-]+)$/,w=/^[\w-]+$/,E={}.toString,S={},x,T,N=o.createElement("div");return S.matches=function(e,t){if(!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;return s&&(i=N).appendChild(e),r=~S.qsa(i,t).indexOf(e),s&&N.removeChild(e),r},x=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},T=function(e){return e.filter(function(t,n){return e.indexOf(t)==n})},S.fragment=function(t,r){r===e&&(r=c.test(t)&&RegExp.$1),r in m||(r="*");var i=m[r];return i.innerHTML=""+t,n.each(s.call(i.childNodes),function(){i.removeChild(this)})},S.Z=function(e,t){return e=e||[],e.__proto__=arguments.callee.prototype,e.selector=t||"",e},S.isZ=function(e){return e instanceof S.Z},S.init=function(t,r){if(!t)return S.Z();if(C(t))return n(o).ready(t);if(S.isZ(t))return t;var i;if(A(t))i=M(t);else if(L(t))i=[n.extend({},t)],t=null;else if(h.indexOf(t.nodeType)>=0||t===window)i=[t],t=null;else if(c.test(t))i=S.fragment(t.trim(),RegExp.$1),t=null;else{if(r!==e)return n(r).find(t);i=S.qsa(o,t)}return S.Z(i,t)},n=function(e,t){return S.init(e,t)},n.extend=function(n){return s.call(arguments,1).forEach(function(r){for(t in r)r[t]!==e&&(n[t]=r[t])}),n},S.qsa=function(e,t){var n;return e===o&&b.test(t)?(n=e.getElementById(RegExp.$1))?[n]:i:e.nodeType!==1&&e.nodeType!==9?i:s.call(y.test(t)?e.getElementsByClassName(RegExp.$1):w.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))},n.isFunction=C,n.isObject=k,n.isArray=A,n.isPlainObject=L,n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)},n.trim=function(e){return e.trim()},n.uuid=0,n.map=function(e,t){var n,r=[],i,s;if(O(e))for(i=0;i<e.length;i++)n=t(e[i],i),n!=null&&r.push(n);else for(s in e)n=t(e[s],s),n!=null&&r.push(n);return _(r)},n.each=function(e,t){var n,r;if(O(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,indexOf:i.indexOf,concat:i.concat,map:function(e){return n.map(this,function(t,n){return e.call(t,n,t)})},slice:function(){return n(s.apply(this,arguments))},ready:function(e){return g.test(o.readyState)?e(n):o.addEventListener("DOMContentLoaded",function(){e(n)},!1),this},get:function(t){return t===e?s.call(this):this[t]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){return this.forEach(function(t,n){e.call(t,n,t)}),this},filter:function(e){return n([].filter.call(this,function(t){return S.matches(t,e)}))},add:function(e,t){return n(T(this.concat(n(e,t))))},is:function(e){return this.length>0&&S.matches(this[0],e)},not:function(t){var r=[];if(C(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):O(t)&&C(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!k(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!k(e)?e:n(e)},find:function(e){var t;return this.length==1?t=S.qsa(this[0],e):t=this.map(function(){return S.qsa(this,e)}),n(t)},closest:function(e,t){var r=this[0];while(r&&!S.matches(r,e))r=r!==t&&r!==o&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&e!==o&&t.indexOf(e)<0)return t.push(e),e});return j(t,e)},parent:function(e){return j(T(this.pluck("parentNode")),e)},children:function(e){return j(this.map(function(){return s.call(this.children)}),e)},siblings:function(e){return j(this.map(function(e,t){return s.call(t.parentNode.children).filter(function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return this.map(function(){return this[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),f(this,"").getPropertyValue("display")=="none"&&(this.style.display=B(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){return this.each(function(){n(this).wrapAll(n(e)[0].cloneNode(!1))})},wrapAll:function(e){return this[0]&&(n(this[0]).before(e=n(e)),e.append(this)),this},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return n(this.map(function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(t){return(t===e?this.css("display")=="none":t)?this.show():this.hide()},prev:function(){return n(this.pluck("previousElementSibling"))},next:function(){return n(this.pluck("nextElementSibling"))},html:function(t){return t===e?this.length>0?this[0].innerHTML:null:this.each(function(e){var r=this.innerHTML;n(this).empty().append(F(this,t,e,r))})},text:function(t){return t===e?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(k(n))for(t in n)this.setAttribute(t,n[t]);else this.setAttribute(n,F(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&this.removeAttribute(e)})},prop:function(t,n){return n===e?this[0]?this[0][t]:e:this.each(function(e){this[t]=F(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+D(t),n);return r!==null?r:e},val:function(t){return t===e?this.length>0?this[0].value:e:this.each(function(e){this.value=F(this,t,e,this.value)})},offset:function(){if(this.length==0)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}},css:function(n,r){if(r===e&&typeof n=="string")return this.length==0?e:this[0].style[x(n)]||f(this[0],"").getPropertyValue(n);var i="";for(t in n)typeof n[t]=="string"&&n[t]==""?this.each(function(){this.style.removeProperty(D(t))}):i+=D(t)+":"+H(t,n[t])+";";return typeof n=="string"&&(r==""?this.each(function(){this.style.removeProperty(D(n))}):i=D(n)+":"+H(n,r)),this.each(function(){this.style.cssText+=";"+i})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return this.length<1?!1:P(e).test(this[0].className)},addClass:function(e){return this.each(function(t){r=[];var i=this.className,s=F(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this),r.length&&(this.className+=(i?" ":"")+r.join(" "))})},removeClass:function(t){return this.each(function(n){if(t===e)return this.className="";r=this.className,F(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(P(e)," ")}),this.className=r.trim()})},toggleClass:function(t,r){return this.each(function(i){var s=F(this,t,i,this.className);(r===e?!n(this).hasClass(s):r)?n(this).addClass(s):n(this).removeClass(s)})}},["width","height"].forEach(function(t){n.fn[t]=function(r){var i,s=t.replace(/./,function(e){return e[0].toUpperCase()});return r===e?this[0]==window?window["inner"+s]:this[0]==o?o.documentElement["offset"+s]:(i=this.offset())&&i[t]:this.each(function(e){var i=n(this);i.css(t,F(this,r,e,i[t]()))})}}),p.forEach(function(e,t){n.fn[e]=function(){var e=n.map(arguments,function(e){return k(e)?e:S.fragment(e)});if(e.length<1)return this;var r=this.length,i=r>1,s=t<2;return this.each(function(n,o){for(var u=0;u<e.length;u++){var a=e[s?e.length-u-1:u];q(a,function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&window.eval.call(window,e.innerHTML)}),i&&n<r-1&&(a=a.cloneNode(!0)),I(t,o,a)}})},n.fn[t%2?e+"To":"insert"+(t?"Before":"After")]=function(t){return n(t)[e](this),this}}),S.Z.prototype=n.fn,S.camelize=x,S.uniq=T,n.zepto=S,n}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(e){function s(e){return e._zid||(e._zid=r++)}function o(e,t,r,i){t=u(t);if(t.ns)var o=a(t.ns);return(n[s(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||o.test(e.ns))&&(!r||s(e.fn)===s(r))&&(!i||e.sel==i)})}function u(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function a(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function f(t,n,r){e.isObject(t)?e.each(t,r):t.split(/\s/).forEach(function(e){r(e,n)})}function l(t,r,i,o,a,l){l=!!l;var c=s(t),h=n[c]||(n[c]=[]);f(r,i,function(n,r){var i=a&&a(r,n),s=i||r,f=function(e){var n=s.apply(t,[e].concat(e.data));return n===!1&&e.preventDefault(),n},c=e.extend(u(n),{fn:r,proxy:f,sel:o,del:i,i:h.length});h.push(c),t.addEventListener(c.e,f,l)})}function c(e,t,r,i){var u=s(e);f(t||"",r,function(t,r){o(e,t,r,i).forEach(function(t){delete n[u][t.i],e.removeEventListener(t.e,t.proxy,!1)})})}function v(t){var n=e.extend({originalEvent:t},t);return e.each(d,function(e,r){n[e]=function(){return this[r]=h,t[e].apply(t,arguments)},n[r]=p}),n}function m(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0,t.call(this)}}}var t=e.zepto.qsa,n={},r=1,i={};i.click=i.mousedown=i.mouseup=i.mousemove="MouseEvents",e.event={add:l,remove:c},e.proxy=function(t,n){if(e.isFunction(t)){var r=function(){return t.apply(n,arguments)};return r._zid=s(t),r}if(typeof n=="string")return e.proxy(t[n],t);throw new TypeError("expected function")},e.fn.bind=function(e,t){return this.each(function(){l(this,e,t)})},e.fn.unbind=function(e,t){return this.each(function(){c(this,e,t)})},e.fn.one=function(e,t){return this.each(function(n,r){l(this,e,t,null,function(e,t){return function(){var n=e.apply(r,arguments);return c(r,t,e),n}})})};var h=function(){return!0},p=function(){return!1},d={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,n,r){var i=!1;if(n=="blur"||n=="focus")e.iswebkit?n=n=="blur"?"focusout":n=="focus"?"focusin":n:i=!0;return this.each(function(s,o){l(o,n,r,t,function(n){return function(r){var i,s=e(r.target).closest(t,o).get(0);if(s)return i=e.extend(v(r),{currentTarget:s,liveFired:o}),n.apply(s,[i].concat([].slice.call(arguments,1)))}},i)})},e.fn.undelegate=function(e,t,n){return this.each(function(){c(this,t,n,e)})},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r){return n==undefined||e.isFunction(n)?this.bind(t,n):this.delegate(n,t,r)},e.fn.off=function(t,n,r){return n==undefined||e.isFunction(n)?this.unbind(t,n):this.undelegate(n,t,r)},e.fn.trigger=function(t,n){return typeof t=="string"&&(t=e.Event(t)),m(t),t.data=n,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})},e.fn.triggerHandler=function(t,n){var r,i;return this.each(function(s,u){r=v(typeof t=="string"?e.Event(t):t),r.data=n,r.target=u,e.each(o(u,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})}),i},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){if(e)this.bind(t,e);else if(this.length)try{this.get(0)[t]()}catch(n){}return this}}),e.Event=function(e,t){var n=document.createEvent(i[e]||"Events"),r=!0;if(t)for(var s in t)s=="bubbles"?r=!!t[s]:n[s]=t[s];return n.initEvent(e,r,!0,null,null,null,null,null,null,null,null,null,null,null,null),n}}(Zepto),function(e){function t(e){var t=this.os={},n=this.browser={},r=e.match(/WebKit\/([\d.]+)/),i=e.match(/(Android)\s+([\d.]+)/),s=e.match(/(iPad).*OS\s([\d_]+)/),o=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),u=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),a=u&&e.match(/TouchPad/),f=e.match(/Kindle\/([\d.]+)/),l=e.match(/Silk\/([\d._]+)/),c=e.match(/(BlackBerry).*Version\/([\d.]+)/);if(n.webkit=!!r)n.version=r[1];i&&(t.android=!0,t.version=i[2]),o&&(t.ios=t.iphone=!0,t.version=o[2].replace(/_/g,".")),s&&(t.ios=t.ipad=!0,t.version=s[2].replace(/_/g,".")),u&&(t.webos=!0,t.version=u[2]),a&&(t.touchpad=!0),c&&(t.blackberry=!0,t.version=c[2]),f&&(t.kindle=!0,t.version=f[1]),l&&(n.silk=!0,n.version=l[1]),!l&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0)}t.call(e,navigator.userAgent),e.__detect=t}(Zepto),function(e,t){function c(e){return e.toLowerCase()}function h(e){return r?r+e:c(e)}var n="",r,i,s,o={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},u=window.document,a=u.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,l={};e.each(o,function(e,i){if(a.style[e+"TransitionProperty"]!==t)return n="-"+c(e)+"-",r=i,!1}),l[n+"transition-property"]=l[n+"transition-duration"]=l[n+"transition-timing-function"]=l[n+"animation-name"]=l[n+"animation-duration"]="",e.fx={off:r===t&&a.style.transitionProperty===t,cssPrefix:n,transitionEnd:h("TransitionEnd"),animationEnd:h("AnimationEnd")},e.fn.animate=function(t,n,r,i){return e.isObject(n)&&(r=n.easing,i=n.complete,n=n.duration),n&&(n/=1e3),this.anim(t,n,r,i)},e.fn.anim=function(r,i,s,o){var u,a={},c,h=this,p,d=e.fx.transitionEnd;i===t&&(i=.4),e.fx.off&&(i=0);if(typeof r=="string")a[n+"animation-name"]=r,a[n+"animation-duration"]=i+"s",d=e.fx.animationEnd;else{for(c in r)f.test(c)?(u||(u=[]),u.push(c+"("+r[c]+")")):a[c]=r[c];u&&(a[n+"transform"]=u.join(" ")),!e.fx.off&&typeof r=="object"&&(a[n+"transition-property"]=Object.keys(r).join(", "),a[n+"transition-duration"]=i+"s",a[n+"transition-timing-function"]=s||"linear")}return p=function(t){if(typeof t!="undefined"){if(t.target!==t.currentTarget)return;e(t.target).unbind(d,arguments.callee)}e(this).css(l),o&&o.call(this)},i>0&&this.bind(d,p),setTimeout(function(){h.css(a),i<=0&&setTimeout(function(){h.each(function(){p.call(this)})},0)},0),this},a=null}(Zepto),function($){function triggerAndReturn(e,t,n){var r=$.Event(t);return $(e).trigger(r,n),!r.defaultPrevented}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n){var r=n.context,i="success";n.success.call(r,e,i,t),triggerGlobal(n,r,"ajaxSuccess",[t,n,e]),ajaxComplete(i,t,n)}function ajaxError(e,t,n,r){var i=r.context;r.error.call(i,n,t,e),triggerGlobal(r,i,"ajaxError",[n,r,e]),ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e),triggerGlobal(n,r,"ajaxComplete",[t,n]),ajaxStop(n)}function empty(){}function mimeToDataType(e){return e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){isObject(e.data)&&(e.data=$.param(e.data)),e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data))}function serialize(e,t,n,r){var i=$.isArray(t);$.each(t,function(t,s){r&&(t=n?r:r+"["+(i?"":t)+"]"),!r&&i?e.add(s.name,s.value):(n?$.isArray(s):isObject(s))?serialize(e,s,n,t):e.add(t,s)})}var jsonpID=0,isObject=$.isObject,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(e){var t="jsonp"+ ++jsonpID,n=document.createElement("script"),r=function(){$(n).remove(),t in window&&(window[t]=empty),ajaxComplete("abort",i,e)},i={abort:r},s;return e.error&&(n.onerror=function(){i.abort(),e.error()}),window[t]=function(r){clearTimeout(s),$(n).remove(),delete window[t],ajaxSuccess(r,i,e)},serializeData(e),n.src=e.url.replace(/=\?/,"="+t),$("head").append(n),e.timeout>0&&(s=setTimeout(function(){i.abort(),ajaxComplete("timeout",i,e)},e.timeout)),i},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0},$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?")),$.ajaxJSONP(settings);settings.url||(settings.url=window.location.toString()),serializeData(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=$.ajaxSettings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest"),mime&&(baseHeaders.Accept=mime,mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime));if(settings.contentType||settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{}),xhr.onreadystatechange=function(){if(xhr.readyState==4){clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:JSON.parse(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,"error",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);return ajaxBeforeSend(xhr,settings)===!1?(xhr.abort(),!1):(settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr)},$.get=function(e,t){return $.ajax({url:e,success:t})},$.post=function(e,t,n,r){return $.isFunction(t)&&(r=r||n,n=t,t=null),$.ajax({type:"POST",url:e,data:t,success:n,dataType:r})},$.getJSON=function(e,t){return $.ajax({url:e,success:t,dataType:"json"})},$.fn.load=function(e,t){if(!this.length)return this;var n=this,r=e.split(/\s/),i;return r.length>1&&(e=r[0],i=r[1]),$.get(e,function(e){n.html(i?$(document.createElement("div")).html(e.replace(rscript,"")).find(i).html():e),t&&t.call(n)}),this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];return n.add=function(e,t){this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace("%20","+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t=[],n;return e(Array.prototype.slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})}),t},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(e){function i(e){return"tagName"in e?e:e.parentNode}function s(e,t,n,r){var i=Math.abs(e-t),s=Math.abs(n-r);return i>=s?e-t>0?"Left":"Right":n-r>0?"Up":"Down"}function u(e){e=o[e],e.timeout&&clearTimeout(e.timeout),e.timeout=null}function a(){o.longTap.timeout=null,t.last&&(t.el.trigger("longTap"),t={})}function f(){o.active.timeout=null,t.last&&t.el.trigger("active")}function l(){u("longTap")}function c(){u("active")}var t={},n,r,o={longTap:{delay:750},active:{delay:0}};e(document).ready(function(){var u,h,p,d,v,m=!1,g="ontouchstart"in window,y="touchstart",b="touchmove",w="touchend";g||(y="mousedown",b="mousemove",w="mouseup"),e(document.body).bind(y,function(r){m=!0,v=g?r.touches[0]:r,u=Date.now(),h=u-(t.last||u),t.el=e(i(v.target)),n&&clearTimeout(n),t.x1=v.pageX,t.y1=v.pageY,t.x2=v.pageX,t.y2=v.pageY,h>0&&h<=250&&(t.isDoubleTap=!0),t.last=u,o.longTap.timeout=setTimeout(a,o.longTap.delay),o.active.timeout=setTimeout(f,o.active.delay)}).bind(b,function(e){if(!m)return;c(),l(),v=g?e.touches[0]:e,t.x2=v.pageX,t.y2=v.pageY,document.webkitPointerLockElement&&(m=!1)}).bind(w,function(e){if(!m)return;m=!1,l(),c(),p=Math.abs(t.x1-t.x2),d=Math.abs(t.y1-t.y2),t.isDoubleTap?(t.el.trigger("doubleTap"),t={}):p>30||d>30?(t.el.trigger("swipe")&&t.el.trigger("swipe"+s(t.x1,t.x2,t.y1,t.y2)),t={}):"last"in t&&p<7&&d<7&&(t.el.trigger("tap"),n=setTimeout(function(){n=null,t.el.trigger("singleTap"),t={}},250))}).bind("touchcancel",function(){n&&clearTimeout(n),r&&clearTimeout(r),r=n=null,t={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap","active"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})}(Zepto),define("_dom",function(e){return function(){return e.$}}(this)),define("dimensions",["require","_dom"],function(e){function n(e,t){return parseInt(e.getPropertyValue(t),10)}var t=e("_dom");t.fn.outerHeight=function(){var e=this[0],n=t.fn.marginHeight.call(this);return e.offsetHeight+n},t.fn.marginHeight=function(){var e=t.fn.margin.call(this);return e.top+e.bottom},t.fn.margin=function(){var e=this[0],t=window.getComputedStyle(e,null),r;return r={top:n(t,"margin-top"),right:n(t,"margin-right"),bottom:n(t,"margin-bottom"),left:n(t,"margin-left")},r.height=r.top+r.bottom,r.width=r.left+r.right,r},t.fn.padding=function(){var e=this[0],t=window.getComputedStyle(e,null);return{top:n(t,"padding-top"),right:n(t,"padding-right"),bottom:n(t,"padding-bottom"),left:n(t,"padding-left")}},t.fn.metrics=function(){var e=this[0],n=e.getBoundingClientRect(),r=t.fn.margin.call(this),i=t.fn.padding.call(this);return{height:e.clientHeight,width:e.clientWidth,top:n.top,right:n.right,bottom:n.bottom,left:n.left,outerHeight:n.height+r.top+r.bottom,outerWidth:n.width+r.left+r.right,marginTop:r.top,marginRight:r.right,marginBottom:r.bottom,marginLeft:r.left,marginHeight:r.height,marginWidth:r.width,paddingTop:i.top,paddingRight:i.right,paddingBottom:i.bottom,paddingLeft:i.left}}}),define("textfit",["require","_dom"],function(e){var t=e("_dom");t.fn.textFit=function(e){return this.each(function(){var e=t(this),n=n||1,r=t('<span style="display:inline-block;margin:0;padding:0;"></span>').html(e.text()),i=parseInt(window.getComputedStyle(this).getPropertyValue("font-size"),10),s=e.width(),o=0;if(s===0)return;e.empty().append(r),o=r.width(),o>=s&&(i=8,e.css("font-size",i+"px"),o=r.width());while(o<s)i+=1,e.css("font-size",i+"px"),o=r.width(),s=e.width();o>=s&&(i-=1),e.css("font-size",i/n+"px")})}}),define("modules/dom",["_dom","dimensions","textfit"],function(e){return e}),function(e,t){function n(e){if(e&&e.__wrapped__)return e;if(!(this instanceof n))return new n(e);this.__wrapped__=e}function r(e,t,n){t||(t=0);var r=e.length,i=r-t>=(n||M),s=i?{}:e;if(i)for(n=t-1;++n<r;){var o=e[n]+"";(I.call(s,o)?s[o]:s[o]=[]).push(e[n])}return function(e){if(i){var n=e+"";return I.call(s,n)&&-1<y(s[n],e)}return-1<y(s,e,t)}}function i(e,n){var r=e.b,i=n.b,e=e.a,n=n.a;if(e!==n){if(e>n||e===t)return 1;if(e<n||n===t)return-1}return r<i?-1:1}function s(e,t,n){function r(){var u=arguments,a=s?this:t;return i||(e=t[o]),n.length&&(u=u.length?n.concat(U.call(u)):n),this instanceof r?(f.prototype=e.prototype,a=new f,(u=e.apply(a,u))&&wt[typeof u]?u:a):e.apply(a,u)}var i=c(e),s=!n,o=e;return s&&(n=t),r}function o(e,n){return e?"function"!=typeof e?function(t){return t[e]}:n!==t?function(t,r,i){return e.call(n,t,r,i)}:e:S}function u(){for(var e={e:"",g:ot,i:"",j:mt,m:ft,n:ht,o:H,p:"",q:T,r:gt,c:{d:""},l:{d:""}},t,n=-1;t=arguments[++n];)for(var r in t){var s=t[r];/d|h/.test(r)?("string"==typeof s&&(s={b:s,k:s}),e.c[r]=s.b,e.l[r]=s.k):e[r]=s}t=e.a;if("d"!=(e.f=/^[^,]+/.exec(t)[0])||!e.c.h)e.c=N;n="",e.r&&(n+=""),n+="var i,A,j="+e.f+",t="+(e.i||e.f)+";if(!"+e.f+")return t;"+e.p+";",e.c&&(n+="var k=j.length;i=-1;",e.l&&(n+="if(k===+k){"),e.n&&(n+="if(y.call(j)==w){j=j.split('')}"),n+=e.c.d+";while(++i<k){A=j[i];"+e.c.h+"}",e.l&&(n+="}"));if(e.l){e.c?n+="else {":e.m&&(n+="var k=j.length;i=-1;if(k&&O(j)){while(++i<k){A=j[i+=''];"+e.l.h+"}}else {"),e.g||(n+="var u=typeof j=='function'&&q.call(j,'prototype');");if(e.j&&e.q)n+="var n=-1,o=Y[typeof j]?l(j):[],k=o.length;"+e.l.d+";while(++n<k){i=o[n];",e.g||(n+="if(!(u&&i=='prototype')){"),n+="A=j[i];"+e.l.h+"",e.g||(n+="}");else{n+=e.l.d+";for(i in j){";if(!e.g||e.q)n+="if(",e.g||(n+="!(u&&i=='prototype')"),!e.g&&e.q&&(n+="&&"),e.q&&(n+="h.call(j,i)"),n+="){";n+="A=j[i];"+e.l.h+";";if(!e.g||e.q)n+="}"}n+="}";if(e.g){n+="var g=j.constructor;";for(r=0;7>r;r++)n+="i='"+e.o[r]+"';if(","constructor"==e.o[r]&&(n+="!(g&&g.prototype===j)&&"),n+="h.call(j,i)){A=j[i];"+e.l.h+"}"}if(e.c||e.m)n+="}"}return n+=e.e+";return t",Function("D,E,F,I,e,f,J,h,M,O,Q,S,T,X,Y,l,q,v,w,y,z","var G=function("+t+"){"+n+"};return G")(yt,L,E,i,B,o,Ht,I,y,l,At,c,Ot,tt,wt,V,R,U,rt,z)}function a(e){return _t[e]}function f(){}function l(e){return z.call(e)==Q}function c(e){return"function"==typeof e}function h(e){var t=C;if(!e||"object"!=typeof e||l(e))return t;var n=e.constructor;return(!pt||"function"==typeof e.toString||"string"!=typeof (e+""))&&(!c(n)||n instanceof n)?at?(Ht(e,function(e,n,r){return t=!I.call(r,n),C}),t===C):(Ht(e,function(e,n){t=n}),t===C||I.call(e,t)):t}function p(e,t,n,r,i){if(e==N)return e;n&&(t=C);if(n=wt[typeof e]){var s=z.call(e);if(!bt[s]||lt&&l(e))return e;var o=s==G,n=o||(s==tt?Ot(e):n)}if(!n||!t)return n?o?U.call(e):Pt({},e):e;n=e.constructor;switch(s){case Y:case Z:return new n(+e);case et:case rt:return new n(e);case nt:return n(e.source,_.exec(e))}r||(r=[]),i||(i=[]);for(s=r.length;s--;)if(r[s]==e)return i[s];var u=o?n(e.length):{};return r.push(e),i.push(u),(o?Vt:Bt)(e,function(e,n){u[n]=p(e,t,N,r,i)}),u}function d(e,t,n,r){if(e==N||t==N)return e===t;if(e===t)return 0!==e||1/e==1/t;if(wt[typeof e]||wt[typeof t])e=e.__wrapped__||e,t=t.__wrapped__||t;var i=z.call(e);if(i!=z.call(t))return C;switch(i){case Y:case Z:return+e==+t;case et:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case nt:case rt:return e==t+""}var s=yt[i];if(lt&&!s&&(s=l(e))&&!l(t)||!s&&(i!=tt||pt&&("function"!=typeof e.toString&&"string"==typeof (e+"")||"function"!=typeof t.toString&&"string"==typeof (t+""))))return C;n||(n=[]),r||(r=[]);for(i=n.length;i--;)if(n[i]==e)return r[i]==t;var i=-1,o=T,u=0;n.push(e),r.push(t);if(s){u=e.length;if(o=u==t.length)for(;u--&&(o=d(e[u],t[u],n,r)););return o}s=e.constructor,o=t.constructor;if(s!=o&&(!c(s)||!(s instanceof s&&c(o)&&o instanceof o)))return C;for(var a in e)if(I.call(e,a)&&(u++,!I.call(t,a)||!d(e[a],t[a],n,r)))return C;for(a in t)if(I.call(t,a)&&!(u--))return C;if(ot)for(;7>++i;)if(a=H[i],I.call(e,a)&&(!I.call(t,a)||!d(e[a],t[a],n,r)))return C;return T}function v(e,t,n,r){var i=e,s=e?e.length:0,o=3>arguments.length;if(s!==+s)var u=It(e),s=u.length;else ht&&z.call(e)==rt&&(i=e.split(""));return Vt(e,function(e,a,f){a=u?u[--s]:--s,n=o?(o=C,i[a]):t.call(r,n,i[a],a,f)}),n}function m(e,t,n){if(e)return t==N||n?e[0]:U.call(e,0,t)}function g(e,t){for(var n=-1,r=e?e.length:0,i=[];++n<r;){var s=e[n];At(s)?q.apply(i,t?s:g(s)):i.push(s)}return i}function y(e,t,n){var r=-1,i=e?e.length:0;if("number"==typeof n)r=(0>n?$(0,i+n):n||0)-1;else if(n)return r=w(e,t),e[r]===t?r:-1;for(;++r<i;)if(e[r]===t)return r;return-1}function b(e,t,n){return e?U.call(e,t==N||n?1:t):[]}function w(e,t,n,r){var i=0,s=e?e.length:i;if(n){n=o(n,r);for(t=n(t);i<s;)r=i+s>>>1,n(e[r])<t?i=r+1:s=r}else for(;i<s;)r=i+s>>>1,e[r]<t?i=r+1:s=r;return i}function E(e,t){return vt||W&&2<arguments.length?W.call.apply(W,arguments):s(e,t,U.call(arguments,2))}function S(e){return e}function x(e){Vt(jt(e),function(t){var r=n[t]=e[t];n.prototype[t]=function(){var e=[this.__wrapped__];return arguments.length&&q.apply(e,arguments),e=r.apply(n,e),this.__chain__&&(e=new n(e),e.__chain__=T),e}})}var T=!0,N=null,C=!1,k="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&(e=global),exports),L=Array.prototype,A=Object.prototype,O=0,M=30,_=/\w*$/,D=RegExp("^"+(A.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),P=/[&<>"']/g,H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),B=L.concat,j=Math.floor,F=D.test(F=Object.getPrototypeOf)&&F,I=A.hasOwnProperty,q=L.push,R=A.propertyIsEnumerable,U=L.slice,z=A.toString,W=D.test(W=U.bind)&&W,X=D.test(X=Array.isArray)&&X,V=D.test(V=Object.keys)&&V,$=Math.max,J=Math.min,K=Math.random,Q="[object Arguments]",G="[object Array]",Y="[object Boolean]",Z="[object Date]",et="[object Number]",tt="[object Object]",nt="[object RegExp]",rt="[object String]",it=e.clearTimeout,st=e.setTimeout,ot,ut,at,ft=T;(function(){function e(){this.x=1}var t={0:1,length:1},n=[];e.prototype={valueOf:1,y:1};for(var r in new e)n.push(r);for(r in arguments)ft=!r;ot=4>(n+"").length,at="x"!=n[0],ut=(n.splice.call(t,0,1),t[0])})(1);var lt=!l(arguments),ct="x"!=U.call("x")[0],ht="xx"!="x"[0]+Object("x")[0];try{var pt=("[object Object]",z.call(e.document||0)==tt)}catch(dt){}var vt=W&&/\n|Opera/.test(W+z.call(e.opera)),mt=V&&/^.+$|true/.test(V+!!e.attachEvent),gt=!vt,yt={};yt[Y]=yt[Z]=yt["[object Function]"]=yt[et]=yt[tt]=yt[nt]=C,yt[Q]=yt[G]=yt[rt]=T;var bt={};bt[Q]=bt["[object Function]"]=C,bt[G]=bt[Y]=bt[Z]=bt[et]=bt[tt]=bt[nt]=bt[rt]=T;var wt={"boolean":C,"function":T,object:T,number:C,string:C,"undefined":C,unknown:T},Et={a:"d,c,x",p:"c=f(c,x)",h:"if(c(A,i,d)===false)return t"},St={i:"{}",p:"c=f(c,x)",h:"var p=c(A,i,d);(h.call(t,p)?t[p]++:t[p]=1)"},xt={i:"true",h:"if(!c(A,i,d))return!t"},Tt={q:C,r:C,a:"m",p:"for(var a=1,b=arguments.length;a<b;a++){if(j=arguments[a]){",h:"t[i]=A",e:"}}"},Nt={i:"[]",h:"c(A,i,d)&&t.push(A)"},Ct={p:"c=f(c,x)"},kt={h:{k:Et.h}},Lt={i:"d||[]",d:{b:"t=Array(k)",k:"t="+(mt?"Array(k)":"[]")},h:{b:"t[i]=c(A,i,d)",k:"t"+(mt?"[n]=":".push")+"(c(A,i,d))"}};lt&&(l=function(e){return e?I.call(e,"callee"):C});var At=X||function(e){return z.call(e)==G};c(/x/)&&(c=function(e){return"[object Function]"==z.call(e)});var Ot=F?function(e){if(!e||"object"!=typeof e)return C;var t=e.valueOf,n="function"==typeof t&&(n=F(t))&&F(n);return n?e==n||F(e)==n&&!l(e):h(e)}:h,Mt=u({a:"m",i:"[]",h:"t.push(i)"}),_t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},Dt=u(Tt,{h:"if(t[i]==null)"+Tt.h}),Pt=u(Tt),Ht=u(Et,Ct,kt,{q:C}),Bt=u(Et,Ct,kt),jt=u({q:C,a:"m",i:"[]",h:"S(A)&&t.push(i)",e:"t.sort()"}),Ft=u({a:"A",i:"true",p:"var H=y.call(A),k=A.length;if(D[H]"+(lt?"||O(A)":"")+"||(H==X&&k===+k&&S(A.splice)))return!k",h:{k:"return false"}}),It=V?function(e){var t=typeof e;return"function"==t&&R.call(e,"prototype")?Mt(e):e&&wt[t]?V(e):[]}:Mt,qt=u({q:C,a:"m,c,x",i:"{}",p:"var R=typeof c=='function';if(R)c=f(c,x);else var s=e.apply(E,arguments)",h:"if(R?!c(A,i,m):M(s,i)<0)t[i]=A"},{p:"if(typeof c!='function'){var i=0,s=e.apply(E,arguments),k=s.length;while(++i<k){var p=s[i];if(p in m)t[p]=m[p]}}else {c=f(c,x)",h:"if(c(A,i,m))t[i]=A",e:"}"}),Rt=u({a:"m",i:"[]",h:"t.push(A)"}),Ut=u({a:"d,hh",i:"false",n:C,d:{b:"if(y.call(d)==w)return d.indexOf(hh)>-1"},h:"if(A===hh)return true"}),zt=u(Et,xt),Wt=u(Et,Nt),Xt=u(Et,Ct,{i:"z",h:"if(c(A,i,d))return A"}),Vt=u(Et,Ct),$t=u(Et,St,{h:"var p=c(A,i,d);(h.call(t,p)?t[p]:t[p]=[]).push(A)"}),Jt=u(Lt,{a:"d,U",p:"var C=v.call(arguments,2),R=typeof U=='function'",h:{b:"t[i]=(R?U:A[U]).apply(A,C)",k:"t"+(mt?"[n]=":".push")+"((R?U:A[U]).apply(A,C))"}}),Kt=u(Et,Lt),Qt=u(Lt,{a:"d,bb",h:{b:"t[i]=A[bb]",k:"t"+(mt?"[n]=":".push")+"(A[bb])"}}),Gt=u({a:"d,c,B,x",i:"B",p:"var V=arguments.length<3;c=f(c,x)",d:{b:"if(V)t=j[++i]"},h:{b:"t=c(t,A,i,d)",k:"t=V?(V=false,A):c(t,A,i,d)"}}),Yt=u(Et,Nt,{h:"!"+Nt.h}),Zt=u(Et,xt,{i:"false",h:xt.h.replace("!","")}),en=u(Et,St,Lt,{h:{b:"t[i]={a:c(A,i,d),b:i,c:A}",k:"t"+(mt?"[n]=":".push")+"({a:c(A,i,d),b:i,c:A})"},e:"t.sort(I);k=t.length;while(k--)t[k]=t[k].c"}),tn=u({q:C,r:C,a:"m",p:"var L=arguments,i=0,k=L.length;if(k>1){while(++i<k)t[L[i]]=F(t[L[i]],t);return t}",h:"if(S(A))t[i]=F(A,t)"});n.VERSION="0.8.2",n.bind=E,n.bindAll=tn,n.clone=p,n.contains=Ut,n.debounce=function(e,t,n){function r(){u=N,n||(s=e.apply(o,i))}var i,s,o,u;return function(){var a=n&&!u;return i=arguments,o=this,it(u),u=st(r,t),a&&(s=e.apply(o,i)),s}},n.defaults=Dt,n.difference=function(e){var t=[];if(!e)return t;for(var n=-1,i=e.length,s=B.apply(L,arguments),s=r(s,i);++n<i;){var o=e[n];s(o)||t.push(o)}return t},n.escape=function(e){return e==N?"":(e+"").replace(P,a)},n.every=zt,n.extend=Pt,n.filter=Wt,n.find=Xt,n.first=m,n.flatten=g,n.forEach=Vt,n.forIn=Ht,n.forOwn=Bt,n.functions=jt,n.groupBy=$t,n.has=function(e,t){return e?I.call(e,t):C},n.identity=S,n.indexOf=y,n.initial=function(e,t,n){return e?U.call(e,0,-(t==N||n?1:t)):[]},n.intersection=function(e){var t=arguments.length,n=[],i=-1,s=e?e.length:0,o=[];e:for(;++i<s;){var u=e[i];if(0>y(o,u)){for(var a=1;a<t;a++)if(!(n[a]||(n[a]=r(arguments[a])))(u))continue e;o.push(u)}}return o},n.invoke=Jt,n.isArguments=l,n.isArray=At,n.isEmpty=Ft,n.isEqual=d,n.isFunction=c,n.isObject=function(e){return e?wt[typeof e]:C},n.isPlainObject=Ot,n.isRegExp=function(e){return z.call(e)==nt},n.keys=It,n.last=function(e,t,n){if(e){var r=e.length;return t==N||n?e[r-1]:U.call(e,-t||r)}},n.lastIndexOf=function(e,t,n){var r=e?e.length:0;for("number"==typeof n&&(r=(0>n?$(0,r+n):J(n,r-1))+1);r--;)if(e[r]===t)return r;return-1},n.lateBind=function(e,t){return s(t,e,U.call(arguments,2))},n.map=Kt,n.max=function(e,t,n){var r=-Infinity,i=-1,s=e?e.length:0,u=r;if(t||s!==+s)t=o(t,n),Vt(e,function(e,n,i){n=t(e,n,i),n>r&&(r=n,u=e)});else for(;++i<s;)e[i]>u&&(u=e[i]);return u},n.memoize=function(e,t){var n={};return function(){var r=t?t.apply(this,arguments):arguments[0];return I.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}},n.min=function(e,t,n){var r=Infinity,i=-1,s=e?e.length:0,u=r;if(t||s!==+s)t=o(t,n),Vt(e,function(e,n,i){n=t(e,n,i),n<r&&(r=n,u=e)});else for(;++i<s;)e[i]<u&&(u=e[i]);return u},n.mixin=x,n.pick=qt,n.pluck=Qt,n.reduce=Gt,n.reduceRight=v,n.reject=Yt,n.rest=b,n.result=function(e,t){var n=e?e[t]:N;return c(n)?e[t]():n},n.shuffle=function(e){var t=-1,n=Array(e?e.length:0);return Vt(e,function(e){var r=j(K()*(++t+1));n[t]=n[r],n[r]=e}),n},n.size=function(e){var t=e?e.length:0;return t===+t?t:It(e).length},n.some=Zt,n.sortBy=en,n.sortedIndex=w,n.throttle=function(e,t){function n(){u=new Date,o=N,i=e.apply(s,r)}var r,i,s,o,u=0;return function(){var a=new Date,f=t-(a-u);return r=arguments,s=this,0>=f?(it(o),u=a,i=e.apply(s,r)):o||(o=st(n,f)),i}},n.toArray=function(e){if(!e)return[];var t=e.length;return t===+t?(ct?z.call(e)==rt:"string"==typeof e)?e.split(""):U.call(e):Rt(e)},n.uniqueId=function(e){var t=O++;return e?e+t:t},n.values=Rt,n.without=function(e){for(var t=-1,n=e?e.length:0,i=r(arguments,1,20),s=[];++t<n;){var o=e[t];i(o)||s.push(o)}return s},n.all=zt,n.any=Zt,n.collect=Kt,n.detect=Xt,n.drop=b,n.each=Vt,n.foldl=Gt,n.foldr=v,n.head=m,n.include=Ut,n.inject=Gt,n.methods=jt,n.select=Wt,n.tail=b,n.take=m,x(n),n.prototype.chain=function(){return this.__chain__=T,this},n.prototype.value=function(){return this.__wrapped__},Vt("pop push reverse shift sort splice unshift".split(" "),function(e){var t=L[e];n.prototype[e]=function(){var e=this.__wrapped__;return t.apply(e,arguments),ut&&e.length===0&&delete e[0],this.__chain__&&(e=new n(e),e.__chain__=T),e}}),Vt(["concat","join","slice"],function(e){var t=L[e];n.prototype[e]=function(){var e=t.apply(this.__wrapped__,arguments);return this.__chain__&&(e=new n(e),e.__chain__=T),e}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e._=n,define("underscore",[],function(){return n})):k?"object"==typeof module&&module&&module.exports==k?(module.exports=n)._=n:k._=n:e._=n}(this),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="0.9.9";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function(e,t,n,r){if(!n)return!0;if(typeof n=="object")for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!a.test(n))return!0;var s=n.split(a);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r))}},l=function(e,t,n){var r,i=-1,s=t.length;switch(n.length){case 0:while(++i<s)(r=t[i]).callback.call(r.ctx);return;case 1:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0]);return;case 2:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1]);return;case 3:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1],n[2]);return;default:while(++i<s)(r=t[i]).callback.apply(r.ctx,n)}},c=o.Events={on:function(e,t,n){if(!f(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,l=o.length;a<l;a++){e=o[a];if(r=this._events[e]){s=[];if(t||n)for(c=0,h=r.length;c<h;c++)i=r[c],(t&&t!==(i.callback._callback||i.callback)||n&&n!==i.context)&&s.push(i);this._events[e]=s}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(this,n,t),r&&l(this,r,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return r[i]=e,e.on(t,n||this,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,n,this),!t&&!n&&delete r[e._listenerId];else{for(var i in r)r[i].off(null,null,this);this._listeners={}}return this}};c.bind=c.on,c.unbind=c.off,u.extend(o,c);var h=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.changed={},this.attributes={},this._changes=[],t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r)),(n=u.result(this,"defaults"))&&u.defaults(r,n),this.set(r,{silent:!0}),this._currentAttributes=u.clone(this.attributes),this._previousAttributes=u.clone(this.attributes),this.initialize.apply(this,arguments)};u.extend(h.prototype,c,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i;if(e==null)return this;u.isObject(e)?(i=e,n=t):(i={})[e]=t;var s=n&&n.silent,o=n&&n.unset;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var a=this.attributes;for(r in i)t=i[r],o?delete a[r]:a[r]=t,this._changes.push(r,t);return this._hasComputed=!1,s||this.change(n),this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r),e))return!1;n&&n(t,r,e)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s;e==null||u.isObject(e)?(r=e,n=t):e!=null&&((r={})[e]=t),n=n?u.clone(n):{};if(n.wait){if(r&&!this._validate(r,n))return!1;i=u.clone(this.attributes)}var o=u.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?o:n))return!1;if(!r&&!this._validate(null,n))return!1;var a=this,f=n.success;n.success=function(e,t,i){s=!0;var o=a.parse(e);n.wait&&(o=u.extend(r||{},o));if(!a.set(o,n))return!1;f&&f(a,e,n)};var l=this.isNew()?"create":n.patch?"patch":"update";l=="patch"&&(n.attrs=r);var c=this.sync(l,this,n);return!s&&n.wait&&(this.clear(o),this.set(i,o)),c},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e)};if(this.isNew())return e.success(),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||M();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){var t=this._changing;this._changing=!0;var n=this._computeChanges(!0);this._pending=!!n.length;for(var r=n.length-2;r>=0;r-=2)this.trigger("change:"+n[r],this,n[r+1],e);if(t)return this;while(this._pending)this._pending=!1,this.trigger("change",this,e),this._previousAttributes=u.clone(this.attributes);return this._changing=!1,this},hasChanged:function(e){return this._hasComputed||this._computeChanges(),e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},_computeChanges:function(e){this.changed={};var t={},n=[],r=this._currentAttributes,i=this._changes;for(var s=i.length-2;s>=0;s-=2){var o=i[s],u=i[s+1];if(t[o])continue;t[o]=!0;if(r[o]!==u){this.changed[o]=u;if(!e)continue;n.push(o,u),r[o]=u}}return e&&(this._changes=[]),this._hasComputed=!0,n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},_validate:function(e,t){if(!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error&&t.error(this,n,t),this.trigger("error",this,n,t),!1):!0}});var p=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))};u.extend(p.prototype,c,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){var n,i,o,a,f,l,c=t&&t.at,h=(t&&t.sort)==null?!0:t.sort;e=u.isArray(e)?e.slice():[e];for(n=e.length-1;n>=0;n--){if(!(a=this._prepareModel(e[n],t))){this.trigger("error",this,e[n],t),e.splice(n,1);continue}e[n]=a,f=a.id!=null&&this._byId[a.id];if(f||this._byCid[a.cid]){t&&t.merge&&f&&(f.set(a.attributes,t),l=h),e.splice(n,1);continue}a.on("all",this._onModelEvent,this),this._byCid[a.cid]=a,a.id!=null&&(this._byId[a.id]=a)}e.length&&(l=h),this.length+=e.length,i=[c!=null?c:this.models.length,0],r.apply(i,e),s.apply(this.models,i),l&&this.comparator&&c==null&&this.sort({silent:!0});if(t&&t.silent)return this;while(a=e.shift())a.trigger("add",a,this,t);return this},remove:function(e,t){var n,r,i,s;t||(t={}),e=u.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byCid[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]||this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),(!e||!e.silent)&&this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},update:function(e,t){var n,r,i,s,o=[],a=[],f={},l=this.model.prototype.idAttribute;t=u.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e)),u.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);for(r=0,i=e.length;r<i;r++)n=e[r],s=this.get(n.id||n.cid||n[l]),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);if(t.remove)for(r=0,i=this.models.length;r<i;r++)n=this.models[r],f[n.cid]||a.push(n);return a.length&&this.remove(a,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){var o=e.update?"update":"reset";t[o](r,e),n&&n(t,r,e)},this.sync("read",this,e)},create:function(e,t){var n=this;t=t?u.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},chain:function(){return u(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(e instanceof h)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var d=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortedIndex","toArray","size","first","head","take","initial","rest","tail","last","without","indexOf","shuffle","lastIndexOf","isEmpty"];u.each(d,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var v=["groupBy","countBy","sortBy"];u.each(v,function(e){p.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var m=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},g=/\((.*?)\)/g,y=/:\w+/g,b=/\*\w+/g,w=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(m.prototype,c,{initialize:function(){},route:function(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){var i=this._extractParameters(e,r);n&&n.apply(this,i),this.trigger.apply(this,["route:"+t].concat(i)),o.history.trigger("route",this,t,i)},this)),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(w,"\\$&").replace(g,"(?:$1)?").replace(y,"([^/]+)").replace(b,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var E=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},S=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,T=/msie [\w.]+/,N=/\/$/;E.started=!1,u.extend(E.prototype,c,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(N,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(S,"")},start:function(e){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=T.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(x,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(S,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!E.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new E;var C=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},k=/^(\S+)\s*(.*)$/,L=["model","collection","el","id","attributes","className","tagName","events"];u.extend(C.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},make:function(e,t,n){var r=document.createElement(e);return t&&o.$(r).attr(t),n!=null&&o.$(r).html(n),r},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(k),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.bind(i,n):this.$el.delegate(s,i,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,L)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className")),this.setElement(this.make(u.result(this,"tagName"),e),!1)}else this.setElement(u.result(this,"el"),!1)}});var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=A[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||M()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e,r,i){a&&a(e,r,i),t.trigger("sync",t,e,n)};var f=n.error;n.error=function(e,r,i){f&&f(t,e,n),t.trigger("error",t,e,n)};var l=o.ajax(u.extend(i,n));return t.trigger("request",t,l,n),l},o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var O=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};h.extend=p.extend=m.extend=C.extend=E.extend=O;var M=function(){throw new Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore","modules/dom"],function(e){return function(){return e.Backbone}}(this)),define("modules/hub",["require","underscore","backbone"],function(e){var t=e("underscore"),n=e("backbone");return t.extend({},n.Events)}),define("modules/Base",["require","backbone"],function(e){var t=e("backbone"),n=function(){this.initialize.apply(this,arguments)};return n.prototype={initialize:function(){}},n.extend=t.Model.extend,n}),define("modules/BaseView",["require","modules/dom","underscore","backbone"],function(e){var t=e("modules/dom"),n=e("underscore"),r=e("backbone");return r.View.extend({startX:0,startY:0,startScale:1,rotation:0,isInDOM:function(){return this.el.parentNode!==null},startTransform:function(e){e.preventDefault(),e.stopPropagation(),this.startX=e.pageX,this.startY=e.pageY,this.startScale=e.scale,this.startRotation=e.rotation,e.currentTarget.classList.add("alf-is-moving")},transformEventTarget:function(e){this.transformElByEvent(e.currentTarget,e)},transformEl:function(e){this.transformElByEvent(this.el,e)},transformElByEvent:function(e,t){t.preventDefault(),t.stopPropagation(),t=t.originalEvent||t;var n=t.pageX-this.startX,r=t.pageY-this.startY,i=t.scale,s=t.rotation-this.startRotation;this.doTransform(e,{x:n,y:r,scale:i,rotation:s})},doTransform:function(e,t){var n="";n+="translate3d("+t.x+"px, "+t.y+"px, 1px)",t.rotation&&(n+="rotate("+t.rotation+"deg) "),n+="scale("+t.scale+") ",e.style.webkitTransition="none",e.style.webkitTransform=n},enableScrolling:function(e){e=e||{x:!0,y:!0};var t=[];e.x&&t.push("alf-is-scrollable-x"),e.y&&t.push("alf-is-scrollable-y"),this.$el.addClass(t.join(" "))},preventDefault:function(e){e.preventDefault()}})}),function(e,t){var n=function(){this.running=!1,this.tasks=[],this._dispatchNextTask=this._dispatchNextTask.bind(this)};n.prototype={dispatch:function(){if(this.running)return;this._dispatchNextTask()},add:function(e,t){this.tasks.push(e),t||this.dispatch()},_dispatchNextTask:function(){if(!this.tasks[0]){this.running=!1;return}this.running=!0,this.tasks.shift()(this._dispatchNextTask)}},typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("vendor/queue",[],function(){return n}):e.Queue=n}(this),define("modules/util",["require","underscore"],function(e){function r(e){return function(){console[e].apply(console,[].slice.call(arguments))}}var t=e("underscore"),n={getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getVendorPrefix:t.memoize(function(e){var r,i=["","webkit","moz","ms"];return e=n.camelize(e),t.find(i,function(t){return document.body.style[t+e]!==undefined})}),prefixStyle:function(e,t){var r=n.getVendorPrefix(e);return t?r+n.camelize(e):"-"+r+"-"+e},camelize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},matchMedia:window.matchMedia&&t.bind(window.matchMedia,window)};return n.dom={getFieldMap:function(e){var t=e.getAttribute("data-map");return t?t.split(" "):[]},getMediaQuery:function(e){return e.getAttribute("data-media")}},window.console||(window.console={}),window.console.log||t.each(["log","warning","error","info"],function(e){window.console[e]=function(){return{}}}),n.console={log:r("log"),warn:r("warn"),error:r("error"),info:r("info")},n}),define("modules/transition/Dispatcher",["require","modules/Base","backbone","underscore","modules/dom","modules/util"],function(e){var t=e("modules/Base"),n=e("backbone"),r=e("underscore"),i=e("modules/dom"),s=e("modules/util"),o=Math,u=t.extend();return r.extend(u.prototype,n.Events,{initialize:function(e){r.bindAll(this,"stopRunning"),this.isReset=!1,this.options=e=r.defaults(e,{}),this._isRunning=!1,this._isReversible=!1,e.target&&this.setTarget(e.target),e.to&&this.setTo(e.to)},setTarget:function(e){this.target=r.defaults(e,{el:null,width:null,height:null,top:null,left:null}),this.calcMetrics()},setTargetEl:function(e){this.setTarget({el:e})},setTo:function(e){this.to=r.defaults(e,{el:null,width:null,height:null})},isRunning:function(){return this._isRunning},stopRunning:function(){this._isRunning=!1},calcMetrics:function(){var e,t,n,s;e=this.target,t=this.to,n=i(e.el),s=i(t.el),e=r.extend(e,e.el.getBoundingClientRect()),t=r.extend(t,{width:t.el.clientWidth,height:t.el.clientHeight}),t.scaleX=e.width/t.width,t.scaleY=e.height/t.height,t.scale=o.max(t.scaleX,t.scaleY),e.scaleX=t.width/e.width,e.scaleY=t.height/e.height,e.scale=o.min(e.scaleX,e.scaleY),this.offsetX=o.round(e.left+(e.width-t.width)/2),this.offsetY=o.round(e.top+(e.height-t.height)/2),t.maskHeight=o.round(e.height/t.scale),t.maskWidth=o.round(e.width/t.scale),t.clipHeight=t.height-t.maskHeight,t.clipWidth=t.width-t.maskWidth},reset:function(){var e=this.to,t=this.options.effect.animateFromProps.call(this);e.el.style.webkitTransitionDuration="0ms";for(var n in t){if(n.toLowerCase().indexOf("transition")!==-1)continue;e.el.style[n]=t[n]}},run:function(e){if(this._isRunning)return!1;this._isRunning=!0,this._isReversible=!0;var t=this,n=this.target,s=this.to,o=function(){t._animate(e)};if(!this.options.upscaleTarget||!n||!n.el){this.trigger("willAppear",this,o);return}n.el.classList.add("alf-is-moving");var u="",a=s.width/2-n.width/2-n.left,f=s.height/2-n.height/2-n.top;u+="translate3d("+a+"px, "+f+"px, 1px) ",u+="scale("+n.scale+") ",i(n.el).one("webkitTransitionEnd",r.bind(this._onScaleEnd,this,e)),n.el.style.webkitTransition="-webkit-transform ease-out 300ms",n.el.style.webkitTransform=u},reverse:function(e){var t=this.options.effect;if(this._isRunning||!this._isReversible)return!1;this._isRunning=!0;var n=this.to,s=(t.reverseProps||t.animateFromProps).call(this);i(n.el).one("webkitTransitionEnd",r.bind(this._onReverseEnd,this,e));for(var o in s)n.el.style[o]=s[o]},reverseTo:function(e,t){this.to={el:e},this.calcMetrics(),this.reverse(t)},_animate:function(e){var t=this.to,n=this.options.effect.animateToProps.call(this);this.reset(),this.trigger("ready",this),i(t.el).one("webkitTransitionEnd",r.bind(this._onAnimateEnd,this,e)),r.each(n,function(e,n){t.el.style[n]=e})},_onAnimateEnd:function(e){var t;this.to&&this.to.el&&this.to.el.style.removeProperty("-webkit-transition"),this.target&&this.target.el&&(t=this.target.el.style,t.removeProperty("-webkit-transform"),t.removeProperty("-webkit-transition"),i(this.target.el).removeClass("alf-is-moving")),e&&e.call(this,this),this.trigger("didAppear",this),setTimeout(this.stopRunning,100)},_onReverseEnd:function(e){this._isReversible=!1,this.to.el.style.webkitTransition="none",this.to.el.style.webkitTransform="none",e&&e.call(this,this),this.trigger("didDisappear",this),setTimeout(this.stopRunning,100)},_onScaleEnd:function(e){var t=this,n=function(){t._animate(e)};this.trigger("willAppear",this,n)}}),u}),define("modules/transition/Appear",["require"],function(e){var t={reverseProps:function(){return{webkitTransition:"-webkit-transform ease-out 300ms",webkitTransform:"translate3d(-1500px, -1500px, 0) scale(0.4)"}},animateFromProps:function(){var e="";return e+="scaleX(0.8) scaleY(0.8) ",{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 300ms",webkitTransform:e,opacity:0}},animateToProps:function(){var e=this.to;return{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 300ms",webkitTransform:"translate3d(0, 0, 0) scaleX(1) scaleY(1)",opacity:1}}};return t}),define("modules/transition/Clip",["require"],function(e){var t=Math,n={animateFromProps:function(){var e="",n=this.to,r=t.round(this.clipHeight/2),i=n.height-r,s=t.round(this.clipWidth/2),o=n.width-s;return e+="translate3d("+this.offsetX+"px, "+this.offsetY+"px, 0px) ",e+="scale("+this.to.scale+") ",{webkitTransition:"-webkit-transform ease-out 300ms, clip ease-out 300ms",webkitTransform:e,clip:"rect("+r+"px, "+o+"px, "+i+"px, "+s+"px) "}},animateToProps:function(){var e=this.to;return{webkitTransition:"-webkit-transform ease-out 300ms, clip ease-out 300ms",webkitTransform:"translate3d(0, 0, 0) scaleX(1) scaleY(1)",clip:"rect(0px, "+e.width+"px, "+e.height+"px, 0px)"}}};return n}),define("modules/transition/Fade",["require"],function(e){var t={animateFromProps:function(){return{webkitTransition:"opacity ease-out 300ms",opacity:0}},animateToProps:function(){return{webkitTransition:"opacity ease-out 300ms",opacity:1}}};return t}),define("modules/transition/Scale",["require"],function(e){var t={animateFromProps:function(){var e="";return e+="translate3d("+this.offsetX+"px, "+this.offsetY+"px, 0px) ",e+="scaleX("+this.scaleX+") scaleY("+this.scaleY+") ",{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 200ms",webkitTransform:e,opacity:0}},animateToProps:function(){var e=this.to;return{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 200ms",webkitTransform:"translate3d(0, 0, 0) scaleX(1) scaleY(1)",opacity:1}}};return t}),define("modules/transition",["require","./transition/Dispatcher","./transition/Appear","./transition/Clip","./transition/Fade","./transition/Scale"],function(e){return{Dispatcher:e("./transition/Dispatcher"),Appear:e("./transition/Appear"),Clip:e("./transition/Clip"),Fade:e("./transition/Fade"),Scale:e("./transition/Scale")}}),define("modules/layer/Manager",["require","modules/Base"],function(e){var t=e("modules/Base");return t.extend({initialize:function(){this.layers=[],this.length=0},add:function(e){return this.layers.push(e),this.length=this.layers.length,this},remove:function(e){var t=this.layers;return t.splice(t.indexOf(e),1),this.length=this.layers.length,this},at:function(e){return this.layers[e]},getPos:function(e){return this.layers.indexOf(e)},getLayerAbove:function(e){return this.at(this.getPos(e)+1)},getLayerBelow:function(e){return this.at(this.getPos(e)-1)}})}),define("modules/layer/View",["require","underscore","modules/BaseView","modules/transition"],function(e){var t=e("underscore"),n=e("modules/BaseView"),r=e("modules/transition"),i=n.extend();t.extend(i.prototype,{initialize:function(e){e&&e.manager&&(this.manager=e.manager,this.manager.add(this))},tearDown:function(){this.stopListening()},show:function(){return this.$el.removeClass("is-hidden"),this},hide:function(){return this.$el.addClass("is-hidden"),this},above:function(){return this.manager.getLayerAbove(this)},below:function(){return this.manager.getLayerBelow(this)},minimize:function(){var e=this,t=this.below();return t.show(),t.transition.reverse(function(){e.hide()}),this},transitionTo:function(e,t,n){return this._createTransition({layer:e,target:n,effect:t,upscaleTarget:!1})},scaleTo:function(e,t,n){return this._createTransition({layer:e,target:n,effect:t,upscaleTarget:!0})},transitionToLayerAbove:function(e,t){return this.transitionTo(this.above(),e,t)},transitionToLayerBelow:function(e,t){return this.transitionTo(this.below(),t,e)},_createTransition:function(e){e.to={el:e.layer.el};var t=new r.Dispatcher(e);return this.listenTo(t,"didDisappear",function(n){e.layer.$el.addClass("is-hidden")}),this.listenTo(t,"ready",function(){e.layer.$el.removeClass("is-hidden")}),t}});var s=i.prototype;return s.getLayerBelow=s.below,s.getLayerAbove=s.above,i}),define("modules/layer/Page",["require","modules/dom","underscore","modules/layer/View","modules/transition"],function(e){var t=e("modules/dom"),n=e("underscore"),r=e("modules/layer/View"),i=e("modules/transition"),s=r.extend();return n.extend(s.prototype,{render:function(){return this}}),s}),define("modules/classnames",["require"],function(e){return{CONTAINER:"alf-container",CONTAINER_FULLSCREEN:"alf-container-fullscreen",CONTAINER_INLINE:"alf-container-inline",CONTAINER_IS_UNLOADED:"alf-container-is-unloaded",REGION:"alf-region",REGION_FLEXIBLE:"alf-region-flexible",SUPPORTS_FULLSCREEN:"alf-supports-fullscreen",FULLSCREEN_CONTENT:"alf-fullscreen-content",CONTROLS_OFF:"alf-controls-off",FULLSCREEN_TOOLBAR:"alf-fullscreen-toolbar",BTN_GROUP:"alf-btn-group",FULLSCREEN_EXIT:"alf-fullscreen-exit",ASSET_STYLESHEET:"alf-asset-stylesheet",IS_OPTIONAL:"alf-is-optional",IS_RESPONSIVE:"alf-is-responsive",IS_BREAKABLE:"alf-is-breakable",IS_NON_BREAKABLE:"alf-is-non-breakable",IS_REARRANGEABLE:"alf-is-rearrangeable",IS_NON_REARRANGEABLE:"alf-is-non-rearrangeable",IS_PLAYING:"alf-is-playing",STICK_TO_NEXT:"alf-stick-to-next",STRETCH_TO_FIT:"alf-stretch-to-fit",ALLOW_MULTIPLE:"alf-allow-multiple",ALLOW_OVERFLOW:"alf-allow-overflow",WIDGET:"alf-widget"}}),define("modules/layer/Fullscreen",["require","underscore","modules/dom","modules/layer/View","modules/classnames","modules/util","modules/hub"],function(e){var t=e("underscore"),n=e("modules/dom"),r=e("modules/layer/View"),i=e("modules/classnames"),s=e("modules/util"),o=e("modules/hub"),u=r.extend();return t.extend(u.prototype,{events:{touchstart:"_onTouchStart",singleTap:"toggleControls","tap .alf-fullscreen-exit":"exitFullscreen",doubleTap:"exitFullscreen",touchend:"preventDefault"},initialize:function(){var e=this.options;t.bindAll(this,"_onScroll"),u.__super__.initialize.apply(this,t.toArray(arguments)),this.position=this.$el.css("position"),this.listenTo(o,"fullscreenWillAppear",this._fullscreenWillAppear),e.resizeToWindow=e.resizeToWindow===undefined?!0:e.resizeToWindow},tearDown:function(){this.stopListening(),this.$el.empty()},render:function(e){var t,r;return r=n("<div>").addClass(i.BTN_GROUP),r.append(n("<button>").addClass(i.FULLSCREEN_EXIT)),this.$toolbar=n("<div>").addClass(i.FULLSCREEN_TOOLBAR),this.$toolbar.append(r),this.$content=n("<div>").addClass(i.FULLSCREEN_CONTENT),this.$content.append(e),t=document.createDocumentFragment(),t.appendChild(this.$toolbar[0]),t.appendChild(this.$content[0]),this.$el.empty().removeClass(i.CONTROLS_OFF).append(t),!this.options.resizeToWindow&&!this.metrics&&this._calculateMetrics(),this},toggleControls:function(){this.$el.toggleClass(i.CONTROLS_OFF)},exitFullscreen:function(e){e&&(e.stopPropagation(),e.preventDefault());var t=this.below();if(this.gestureStarted||t.transition.isRunning())return!1;n(window).off("mousewheel",this._onMouseWheelScroll).off("scroll touchmove touchend",this._onScroll),t.transition.reverse(),o.trigger("fullscreenWillDisappear")},_calculateMetrics:function(){this._windowHeight=window.innerHeight,this._windowWidth=window.innerWidth,this.metrics=this.$el.metrics()},_onTouchStart:function(e){var t=n(e.target),r;r=t.css("overflow");if(r==="scroll"||r==="auto")return;e.preventDefault()},_onTap:function(e){this.exitFullscreen()},_onGestureStart:function(e){if(this.gestureStarted||this.below().transition.isRunning())return!1;this.gestureStarted=!0,this.startTransform(e)},_onGestureChange:function(e){if(this.below().transition.isRunning())return!1;this.transformEventTarget(e)},_onGestureEnd:function(e){var t=this.below();if(t.transition.isRunning())return!1;t.transition.reverse(),this.gestureStarted=!1},_fullscreenWillAppear:function(e){var t,r,i,o;i={},this.options.resizeToWindow&&(i.width=window.innerWidth+"px",i.height=window.innerHeight+"px"),this.position!=="fixed"&&(this.x=window.pageXOffset,this.y=window.pageYOffset,i[s.prefixStyle("transform")]="translate("+this.x+"px, "+this.y+"px)"),this.$el.css(i),n(window).on("mousewheel",this._onMouseWheelScroll).on("scroll touchmove touchend",this._onScroll)},_onMouseWheelScroll:function(e){e.preventDefault()},_onScroll:function(e){if(this.position==="fixed"||this.y===window.pageYOffset&&this.x===window.pageXOffset)return;this.y=window.pageYOffset,this.x=window.pageXOffset,this.$el.css(s.prefixStyle("transform"),"translate("+this.x+"px, "+this.y+"px)")}}),u}),define("modules/layer",["require","./layer/Manager","./layer/View","./layer/Page","./layer/Fullscreen"],function(e){return{Manager:e("./layer/Manager"),View:e("./layer/View"),Page:e("./layer/Page"),Fullscreen:e("./layer/Fullscreen")}}),define("modules/layout/WidgetList",["require","modules/Base","underscore"],function(e){var t=e("modules/Base"),n=e("underscore"),r=t.extend({initialize:function(e){this.widgets=[],n.isPlainObject(e)&&n.each(e,function(e,t){this.add(e,t)},this)},add:function(e,t){this.widgets.push(this.normalize(e,t))},normalize:function(e,t){typeof e=="function"&&(e={run:e}),n.defaults(e,{compile:!1,render:function(){},run:function(e){e()},fullscreen:function(e,t){t()},selector:t});if(!e.selector)throw new Error("Failed to normalize widget. No selector found!");return e},getMatchesForContainer:function(e){var t=[];return this.each(function(n){var r=e.$el.is(n.selector)?e.$el:e.$el.find(n.selector);r.length&&t.push({container:e,widget:n,$el:r,el:r[0]})},this),t}});return n.each(["each","map","isEmpty","filter"],function(e){r.prototype[e]=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this.widgets),n[e].apply(n,t)}}),r}),define("vendor/swiper",["require"],function(e){var t=5,n=["_onMove","_onMoveStart","_onMoveEnd","_onMoveStartCapture","_onMoveCapture","_onMoveEndCapture","_onTransitionEnd","_onKeyPress","_refresh","_renderPages"],r=Array.prototype.slice,i=function(e,t,n){return r.call(e).forEach(t,n)},s=function(e,t){var r=this,s=e.children[0];n.forEach(function(e){r[e]=r[e].bind(r)}),this.el=e,this.elements={pageContainer:s,pages:[],scrollablePages:[]},i(s.children,function(e,t){this.elements.pages.push({el:e,offset:t*100,pageNum:t}),e.classList.contains("is-scrollable")&&this.elements.scrollablePages.push(e)},this),this.concurrentPages=this.elements.pages.length,t=t||{},t.overflowScrolling=t.overflowScrolling||!1,t.renderDeferTime=t.renderDeferTime||200,t.scrollDuration=t.scrollDuration||320,t.tapToFlip=t.tapToFlip||!1,t.loadingClass=t.loadingClass||"swiper-page-is-loading",t.enableKeyNavigation=t.enableKeyNavigation===undefined?!0:t.enableKeyNavigation,this.options=t,this.events={},this.renderTimeout=null,this.pageFlipWidth=50,this.x=0,this.currentPage=0};return s.prototype={start:function(){this.pageWidth=this.elements.pages[0].el.clientWidth,this.windowWidth=window.innerWidth,this._renderPages(),this.enable()},gotoPage:function(e,t){var n=this,r,i,s=0;t=t!==undefined?t:this.options.scrollDuration,e=parseInt(e,10),clearTimeout(this.renderTimeout),e<0||isNaN(e)||this.options.numberOfPages===0?e=0:e>this.options.numberOfPages-1&&(e=this.options.numberOfPages-1),this.prevPage=this.currentPage,this.currentPage=e,e>0&&e<this.options.numberOfPages-1&&this._positionPages(),this.x=e*this.pageWidth*-1,this._moveX(this.elements.pageContainer,this.x+"px",t),t===0&&this._onPageChange(!0);if(this.prevPage===this.currentPage)return;r=this.elements.pages[e%this.concurrentPages],n.trigger("pageWillAppear",r.el.children[1],e),i=this.elements.pages[this.prevPage%this.concurrentPages],n.trigger("pageWillDisappear",i.el.children[1],this.prevPage)},on:function(e,t,n){var r=this.events[e]||(this.events[e]=[]);r.push({callback:t,context:n||this})},trigger:function(e){var t=this.events[e],n;if(!t)return;n=r.call(arguments,1);for(var i in t)t[i].callback.apply(t[i].context,n)},enable:function(){var e=this.elements.pageContainer;this._disableOverflowScrolling(),e.addEventListener("touchstart",this._onMoveStartCapture,!0),e.addEventListener("webkitTransitionEnd",this._onTransitionEnd,!0),e.addEventListener("transitionend",this._onTransitionEnd,!0),window.addEventListener("keydown",this._onKeyPress,!1),window.addEventListener("resize",this._refresh,!0)},disable:function(){this._enableOverflowScrolling(),this.elements.pageContainer.addEventListener("touchstart",this._onMoveStartCapture,!0),window.removeEventListener("keydown",this._onKeyPress,!1),window.removeEventListener("resize",this._refresh,!0)},gotoCurrentPage:function(e){this.gotoPage(this.currentPage,e)},gotoPrevPage:function(){this.gotoPage(this.currentPage-1,this.options.scrollDuration)},gotoNextPage:function(){this.gotoPage(this.currentPage+1,this.options.scrollDuration)},refresh:function(e){this.elements.pages.forEach(function(e){e.prevPage=undefined}),e=e||{};for(var t in e)this.options[t]=e[t];this._renderPages()},reset:function(e){this.x=0,this.currentPage=0,this._moveX(this.elements.pageContainer,0,0),i(this.elements.pages,function(e,t){this.trigger("pageWillDestruct",e.el.children[1],e.pageNum),e.offset=t*100,e.prevOffset=undefined,e.pageNum=t,e.prevPage=undefined,this._moveX(e.el,e.offset+"%",0)},this),this.refresh(e)},_positionPages:function(){var e=this,t=this.currentPage,n=[],r=(this.concurrentPages-1)/2,i=t-r,s=t+r;i=i<0?0:i,s=s<this.options.numberOfPages?s:this.options.numberOfPages-1;for(var o=i;o<=s;o++){var u=this.elements.pages[o%this.concurrentPages],a=o*100,f=u.el.children[0];u.prevOffset=u.offset===undefined?a:u.offset,u.offset=a,u.prevOffset!==u.offset&&(f.classList.add(e.options.loadingClass),this._moveX(u.el,u.offset+"%"))}},_renderPage:function(e,t){var n=e.el.children[1],r=e.prevPage===undefined;e.prevPage=e.pageNum,e.pageNum=t;if(r||e.prevPage!==e.pageNum)n.scrollTop=0,n.scrollLeft=0,r||this.trigger("pageWillDestruct",n,e.prevPage),this.trigger("pageWillRender",n,t);e.el.children[0].classList.remove(this.options.loadingClass)},_renderPages:function(){var e=this,t,n,r=this.currentPage,i=r,s=this.options,o=this.elements.pages,u=r<=this.prevPage?1:-1;for(var a=0;a<this.concurrentPages;a++){i+=a*u,u*=-1,t=o[i%this.concurrentPages];if(!t||i>s.numberOfPages-1)continue;e._renderPage(t,i)}e.trigger("pageDidAppear",o[r%this.concurrentPages].el.children[1],r),n=o[this.prevPage%this.concurrentPages],n&&e.trigger("pageDidDisappear",n.el.children[1],this.prevPage)},_refresh:function(e){this.pageWidth=this.elements.pages[0].el.clientWidth,this.windowWidth=window.innerWidth,this.gotoCurrentPage()},_onKeyPress:function(e){if(!this.options.enableKeyNavigation)return;switch(e.keyCode){case 37:this.gotoPrevPage();break;case 39:this.gotoNextPage()}},_onMoveStartCapture:function(e){var t=this.elements.pageContainer;this.moved=!1,this.pointX=e.touches[0].pageX,this.pointY=e.touches[0].pageY,this.deltaX=0,this.deltaY=0,this.distX=0,this.distY=0,this.directionCalc=!1,this.multitouch=e.touches.length>1,this.multitouch?(this._disableOverflowScrolling(),t.removeEventListener("touchmove",this._onMoveCapture,!0),t.removeEventListener("touchend",this._onMoveEndCapture,!0)):(t.addEventListener("touchmove",this._onMoveCapture,!0),t.addEventListener("touchend",this._onMoveEndCapture,!0)),t.addEventListener("touchstart",this._onMoveStart,!1)},_onMoveCapture:function(e){var t=this.elements.pageContainer,n=e.touches[0].pageX,r=e.touches[0].pageY;if(this.multitouch)return;this.deltaX=n-this.pointX,this.deltaY=r-this.pointY,this.pointX=n,this.pointY=r;if(this.directionCalc)return;this.distX<4&&this.distY<4&&(this.distX+=Math.abs(this.deltaX),this.distY+=Math.abs(this.deltaY),this.directionCalc=!0),this.distY<2||this.distX>this.distY+5?(this._disableOverflowScrolling(),t.addEventListener("touchmove",this._onMove,!1),t.addEventListener("touchend",this._onMoveEnd,!1)):(this.distX<2||this.distY>this.distX+5)&&this._enableOverflowScrolling()},_onMoveEndCapture:function(e){this.elements.pageContainer.removeEventListener("touchstart",this._onMoveStart,!1),this._disableOverflowScrolling();if(this.options.tapToFlip&&!this.moved){if(this.pointX<this.pageFlipWidth){this.gotoPrevPage();return}if(this.pointX>this.windowWidth-this.pageFlipWidth){this.gotoNextPage();return}}},_onMoveStart:function(e){this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY},_onMove:function(e){e.preventDefault(),clearTimeout(this.renderTimeout),this.moved=!0;if(this.x>0||this.currentPage===this.options.numberOfPages-1&&this.x<0)this.deltaX*=.5;this.x+=this.deltaX,this._moveX(this.elements.pageContainer,Math.round(this.x)+"px",0)},_onMoveEnd:function(){var e=this.elements.pageContainer,n=this.startX-this.pointX,r=Math.abs(n),i=Math.abs(this.deltaX),s=this.pageWidth/2,o=this.options.scrollDuration;this.elements.pageContainer.style.webkitTransitionDuration=o+"ms",this.elements.pageContainer.style.MozTransitionDuration=o+"ms",e.removeEventListener("touchmove",this._onMove,!1),e.removeEventListener("touchend",this._onMoveEnd,!1),this._disableOverflowScrolling(),r<s&&i<t?this.gotoCurrentPage():n>0?this.gotoNextPage():this.gotoPrevPage()},_moveX:function(e,t,n){n!==undefined&&(e.style.webkitTransitionDuration=n+"ms",e.style.MozTransitionDuration=n+"ms"),e.style.webkitTransform="translate3d("+t+", 0, 0)",e.style.MozTransform="translate("+t+", 0)"},_onPageChange:function(e){e?this._renderPages():this.renderTimeout=setTimeout(this._renderPages,this.options.renderDeferTime)},_onTransitionEnd:function(e){if(e.propertyName.indexOf("transform")===-1)return;this._onPageChange()},_preventDefaultEvent:function(e){e.preventDefault()},_disableOverflowScrolling:function(){if(!this.options.overflowScrolling)return;var e=this;i(this.elements.scrollablePages,function(t){t.addEventListener("touchmove",e._preventDefaultEvent,!0)})},_enableOverflowScrolling:function(){if(!this.options.overflowScrolling)return;var e=this;i(this.elements.scrollablePages,function(t){t.removeEventListener("touchmove",e._preventDefaultEvent,!0)})}},s.prototype.destroy=s.prototype.disable,s}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),define("modules/nav/ScrollView",["require","vendor/swiper"],function(e){return e("vendor/swiper")}),define("modules/layout/widgets/inline",["require","modules/dom","underscore","modules/nav/ScrollView"],function(e){var t=e("modules/dom"),n=e("underscore"),r=e("modules/nav/ScrollView");return{".alf-slideshow":{compile:!0,render:function(){var e,n,r;e=t("<div>").css({position:"relative",top:0,left:0}),n=t("<div>").addClass("alf-slideshow-toggle alf-fullscreen-toggle alf-is-draggable"),this.$el.children(":not(:first-child)").remove(),e.append(n).append(this.$el),r=t("<div>").addClass("alf-slideshow-stack"),this.$el.addClass("alf-slideshow-inline").prepend(r.clone().addClass("alf-slideshow-stack-1")).prepend(r.clone().addClass("alf-slideshow-stack-2")),this.container.$el.append(e)},run:function(e){var t=this.container.$el.find(".alf-slideshow-toggle");t.length&&t.css("display")!=="none"&&this.container.preventDefaultEvents(),this.container.$el.on("tap",".alf-fullscreen-toggle",this.container.enterFullscreen).on("touchend",".alf-fullscreen-toggle",function(e){e.preventDefault()}),e()},fullscreen:function(e,n){var i,s,o,u;o=e.$el.find(".alf-slideshow").children().clone(),u=o.length,s=t('<button class="alf-slideshow-progress"></button>'),s.text("1/"+u),e.layer.$toolbar.append(s),i=t('<div class="alf-slideshow"><div class="alf-pages"><div class="alf-page alf-page-1"><section class="alf-page-loader swiper-page-is-loading"></section><section class="alf-page-content"></section></div><div class="alf-page alf-page-2"><section class="alf-page-loader swiper-page-is-loading"></section><section class="alf-page-content"></section></div><div class="alf-page alf-page-3"><section class="alf-page-loader swiper-page-is-loading"></section><section class="alf-page-content"></section></div></div></div>'),e.$el.empty().append(i);var a=new r(i[0],{numberOfPages:o.length,enableKeyNavigation:!0});a.on("pageWillRender",function(e,n){t(e).empty().append(o[n])}),a.on("pageWillAppear",function(e,t){s.text(t+1+"/"+u)}),a.start(),n()}},".alf-twitter":{compile:!1,run:function(e){var r,i,s,o;r=this.container,i=t('<ul class="unstyled twitter-stream"></ul>'),s=this.$el.attr("data-query"),o="https://search.twitter.com/search.json?rpp=25&result_type=recent&include_entities=true&q="+s+"&callback=?",r.$el.empty(),t.get(o,function(t){n.each(t.results,function(e){i.append('<li class="tweet"><div class="tweet-content"><div class="item-header"><strong>'+e.from_user_name+'</strong><span class="">@'+e.from_user+'</span></div><img src="'+e.profile_image_url+'"><p>'+e.text+"</p></div></li>")}),r.$el.append(i),r.enableScrolling(),e()},"jsonp")}},".alf-stretch-to-fit h1":{compile:!0,render:function(){this.$el.textFit()}}}}),define("modules/layout/mixins/Widgetable",["require","underscore","modules/layout/WidgetList","modules/layout/widgets/inline"],function(e){var t=e("underscore"),n=e("modules/layout/WidgetList"),r=e("modules/layout/widgets/inline");return{setupWidgets:function(e){var i;this.widgets=e.widgets,e.widgets instanceof n||(this.widgets=new n(r),i=t.isArray(e.widgets),t.each(e.widgets,function(e,t){this.widgets.add(e,i?undefined:t)},this))}}}),define("modules/layout/mixins/LayoutElement",["require","modules/dom","underscore","modules/classnames","modules/util"],function(e){function s(e){return n.isArray(e)?e:i.dom.getFieldMap(e.el)}var t=e("modules/dom"),n=e("underscore"),r=e("modules/classnames"),i=e("modules/util"),o={defaultMetrics:function(e){this.metrics=n.defaults(e||{},this.metrics||{},{height:0,width:0,outerHeight:0,lineHeight:24,marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,marginHeight:0,marginWidth:0})},setMetrics:function(e){this.metrics=n.extend(this.metrics||{},e)},calculateMetrics:function(){if(!this.el.children.length){this.metrics=this.$el.metrics();return}var e=parseInt(window.getComputedStyle(this.el).getPropertyValue("border-bottom-width"),10);if(e){this.metrics=this.$el.metrics();return}this.el.style.borderBottom="1px solid transparent",this.metrics=this.$el.metrics(),this.metrics.lineHeight=this.metrics.lineHeight,this.el.style.removeProperty("border-bottom"),this.metrics.outerHeight-=1},lockSize:function(){var e=this.metrics;this.$el.css({height:e.height+"px",width:e.width+"px"})},normalize:function(){var e={},t=this.$el.hasClass(r.CONTAINER),i=this.metrics,s=i.lineHeight,o=0;t||i.marginTop&&(i.outerHeight-=i.marginTop,i.marginHeight-=i.marginTop,i.marginTop=0,e["margin-top"]=0),o=i.outerHeight%s,o!==0&&!t&&(o=i.lineHeight-o,i.marginBottom+=o,i.marginHeight+=o,i.outerHeight+=o,e["margin-bottom"]=i.marginBottom+"px"),n.isEmpty(e)||this.$el.css(e)}};return o}),define("modules/BaseModel",["require","backbone"],function(e){var t=e("backbone");return t.Model.extend({})}),define("modules/layout/Format",["require","modules/BaseModel"],function(e){var t=e("modules/BaseModel"),n=t.extend({defaults:{title:"",name:"",width:0,height:0},initializeFromWindow:function(){return this.set({width:window.innerWidth,height:window.innerHeight,name:"window",title:"Window"}),this}});return n}),define("modules/layout/Figure",["require","underscore","modules/BaseView","modules/util","modules/classnames"],function(e){var t=e("underscore"),n=e("modules/BaseView"),r=e("modules/util"),i=e("modules/classnames"),s=n.extend({initialize:function(){this.elements=t.toArray(this.$el.children())},setElement:function(e){s.__super__.setElement.call(this,e),this.isOptional=this.$el.hasClass(i.IS_OPTIONAL)},clone:function(){var e=new s({el:this.el.cloneNode(!0)});return e.metrics=this.metrics,e},getElementMappedToField:function(e){var n=t.filter(this.elements,function(i){var s=r.dom.getFieldMap(i);return t.intersection(e,s).length?i:!1});return n?n[0]:!1}});return s}),function(e){e("when",[],function(){function r(e,t,n,r){return i(e).then(t,n,r)}function i(e){var t,n;return e instanceof o?t=e:l(e)?(n=f(),e.then(function(e){n.resolve(e)},function(e){n.reject(e)},function(e){n.progress(e)}),t=n.promise):t=u(e),t}function s(e){return r(e,a)}function o(e){this.then=e}function u(e){var t=new o(function(t){try{return i(t?t(e):e)}catch(n){return a(n)}});return t}function a(e){var t=new o(function(t,n){try{return n?i(n(e)):a(e)}catch(r){return a(r)}});return t}function f(){function h(e,t,n){return u(e,t,n)}function p(e){return c(e)}function d(e){return c(a(e))}function v(e){return l(e)}var e,t,r,s,u,l,c;return t=new o(h),e={then:h,resolve:p,reject:d,progress:v,promise:t,resolver:{resolve:p,reject:d,progress:v}},r=[],s=[],u=function(e,t,n){var i,o;return i=f(),o=typeof n=="function"?function(e){try{i.progress(n(e))}catch(t){i.progress(t)}}:function(e){i.progress(e)},r.push(function(n){n.then(e,t).then(i.resolve,i.reject,o)}),s.push(o),i.promise},l=function(e){return y(s,e),e},c=function(e){return e=i(e),u=e.then,c=i,l=w,y(r,e),s=r=n,e},e}function l(e){return e&&typeof e.then=="function"}function c(e,t,n,i,s){return b(2,arguments),r(e,function(e){function g(e){p(e)}function y(e){h(e)}var o,u,a,l,c,h,p,d,v,m;v=e.length>>>0,o=Math.max(0,Math.min(t,v)),a=[],u=v-o+1,l=[],c=f();if(!o)c.resolve(a);else{d=c.progress,p=function(e){l.push(e),--u||(h=p=w,c.reject(l))},h=function(e){a.push(e),--o||(h=p=w,c.resolve(a))};for(m=0;m<v;++m)m in e&&r(e[m],y,g,d)}return c.then(n,i,s)})}function h(e,t,n,r){function i(e){return t?t(e[0]):e[0]}return c(e,1,i,n,r)}function p(e,t,n,r){return b(1,arguments),v(e,E).then(t,n,r)}function d(){return v(arguments,E)}function v(e,t){return r(e,function(e){var n,i,s,o,u,a;s=i=e.length>>>0,n=[],a=f();if(!s)a.resolve(n);else{o=function(i,o){r(i,t).then(function(e){n[o]=e,--s||a.resolve(n)},a.reject)};for(u=0;u<i;u++)u in e?o(e[u],u):--s}return a.promise})}function m(n,i){var s=t.call(arguments,1);return r(n,function(t){var n;return n=t.length,s[0]=function(e,t,s){return r(e,function(e){return r(t,function(t){return i(e,t,s,n)})})},e.apply(t,s)})}function g(e,t,n){var i=arguments.length>2;return r(e,function(e){return e=i?n:e,t.resolve(e),e},function(e){return t.reject(e),a(e)},t.progress)}function y(e,t){var n,r=0;while(n=e[r++])n(t)}function b(e,t){var n,r=t.length;while(r>e){n=t[--r];if(n!=null&&typeof n!="function")throw new Error("arg "+r+" must be a function")}}function w(){}function E(e){return e}var e,t,n;return r.defer=f,r.resolve=i,r.reject=s,r.join=d,r.all=p,r.map=v,r.reduce=m,r.any=h,r.some=c,r.chain=g,r.isPromise=l,o.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(n,e)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return p(t,function(t){return e.apply(n,t)})})}},t=[].slice,e=[].reduce||function(e){var t,n,r,i,s;s=0,t=Object(this),i=t.length>>>0,n=arguments;if(n.length<=1)for(;;){if(s in t){r=t[s++];break}if(++s>=i)throw new TypeError}else r=n[1];for(;s<i;++s)s in t&&(r=e(r,t[s],s,t));return r},r})}(typeof define=="function"&&define.amd?define:function(e){typeof exports=="object"?module.exports=e():this.when=e()}),define("modules/layout/ContentRetainer",["require","underscore"],function(e){var t=e("underscore"),n={retain:function(e){this.content.retain(e),this.retained=this.retained||[],this.retained.push(e)},releaseAll:function(){if(!this.retained||!this.retained.length)return;this.content.release(this.retained),this.retained=[]},didRetainElements:function(){return!!this.retained&&this.retained.length>0}};return n}),define("modules/layout/Container",["require","underscore","modules/dom","modules/BaseView","modules/transition","modules/layout/mixins/LayoutElement","modules/classnames","modules/hub","modules/util","when"],function(e){var t=e("underscore"),n=e("modules/dom"),r=e("modules/BaseView"),i=e("modules/transition"),s=e("modules/layout/mixins/LayoutElement"),o=e("modules/classnames"),u=e("modules/hub"),a=e("modules/util"),f=e("when"),l=r.extend();return l.loadedAssets=[],t.extend(l.prototype,s,{fullscreenEvents:{"touchend img":"onTouchEnd","tap img":"onTap"},className:o.CONTAINER,initialize:function(){var e=this.options||(this.options={});this.id=this.el.id||this._setUniqueId(),t.bindAll(this,"load","_doLoad","_loadComplete","_loadReady","enterFullscreen"),this.defaultMetrics(),this.deferreds=[],this.loaded=null,this.isDirty=!1,e.pixelRatio=parseInt(e.pixelRatio||window.devicePixelRatio||1,10)},tearDown:function(){this.stopListening(),this.undelegateEvents(),this.el=null,this.figureEl=null,this.fullscreenEl&&n(this.fullscreenEl).remove(),this.fullscreenEl=null,this.$el.find("img").each(function(){this.style.removeProperty("max-width"),this.style.removeProperty("max-height"),this.style.removeProperty("width"),this.style.removeProperty("height")})},clone:function(){var e;return e=new l({el:this.el.cloneNode(!0)}),e._setUniqueId(),e},setElement:function(e){l.__super__.setElement.call(this,e),this.fieldMap=a.dom.getFieldMap(this.el),this.isOptional=this.$el.hasClass(o.IS_OPTIONAL)},setFigure:function(e,t){return this.figure=e,this.figureEl=t,this},setLayer:function(e){this.layer=e,this.fullscreenLayer||(this.fullscreenLayer=e.above()),this._setupFullscreen()},setFullscreenEl:function(e){this.fullscreenEl=e,this._setupFullscreen()},preventDefaultEvents:function(){this.undelegateEvents(this.fullscreenEvents)},isRearrangeable:function(){return!0},render:function(){return this.rendered?this:(this.$el.append(this.figureEl.cloneNode(!0)),this._originalHtml=this.$el.html(),this.rendered=!0,this)},revert:function(){this.$el.html(this._originalHtml)},load:function(){f.all(this._runWidgets(),this._doLoad)},unload:function(e){if(this.loaded===!1)return;var t=n(e||this.el);this.loaded=!1,t.addClass(o.CONTAINER_IS_UNLOADED),t.find("[data-src]").each(function(){this.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")})},addDeferred:function(e){this.deferreds.push(e)},shouldStickToNext:function(){return!1},enterFullscreen:function(e){if(!this._supportsFullscreen){a.console.warn("This container does not support fullscreen"),this.layer||a.console.warn("  Missing layer"),this.fullscreenEl||a.console.warn("  Missing fullscreenEl");return}var t=this.transition;if(this.gestureStarted||t.isRunning())return!1;this.layer.transition=t,e&&e instanceof HTMLElement&&t.setTargetEl(e),t.run()},_setupFullscreen:function(){if(this._supportsFullscreen||!(this.fullscreenEl&&this.layer&&this.fullscreenLayer))return;this.transition=this.transition||this.layer.transitionTo(this.fullscreenLayer,i.Fade),this.$el.addClass(o.SUPPORTS_FULLSCREEN),this.listenTo(this.transition,{willAppear:this._fullscreenWillAppear,didAppear:this._fullscreenDidAppear,didDisappear:this._fullscreenDidDisappear}),this.layer.transition=this.transition,this.delegateEvents(this.fullscreenEvents),this._supportsFullscreen=!0},_setUniqueId:function(e){return e||(e=t.uniqueId("c")),this.id=e,this.el.id=e,e},_runWidgets:function(){var e,n=[];return t.each(this.matchingWidgets,function(t){e=f.defer(),t.widget.compile||(this.isDirty=!0),t.widget.run.call(t,e.resolve),n.push(e)},this),n},_doLoad:function(){var e=this,t=this.options.pixelRatio,n;if(this.loaded)return;return this.$el.hasClass(o.ALLOW_OVERFLOW)||this._fitBoundaries(),this.$assets=this.$el.find("[data-src]"),this.$assets.each(function(){e._trackAssetProgress(this)}),f.any(this.deferreds,this._loadReady),f.all(this.deferreds,this._loadComplete),n="data-src"+(t>1?"-"+t+"x":""),this.$assets.each(function(){this.src=this.getAttribute(n)}),this.loaded=!0,this},_fullscreenWillAppear:function(e,t){this.trigger("fullscreenWillAppear",e,t)},_fullscreenDidAppear:function(e){this.trigger("fullscreenDidAppear",e)},_fullscreenDidDisappear:function(e){this.trigger("fullscreenDidDisappear",this),u.trigger("fullscreenDidDisappear",this)},_loadReady:function(){this.$el.removeClass(o.CONTAINER_IS_UNLOADED)},_loadComplete:function(){this.trigger("loadComplete")},_trackAssetProgress:function(e){var t=f.defer();this.addDeferred(t),l.loadedAssets.indexOf(e.getAttribute("data-src"))!==-1?t.resolve({},e):e.addEventListener("load",function(e){l.loadedAssets.push(this.getAttribute("data-src")),t.resolve(e,this)})},_fitBoundaries:function(){var e=[],r=this;if(this.decompiled)return;this.$el.find("img").each(function(){var t=this.clientWidth,n=this.clientHeight,i;t>r.metrics.width&&(i=r.metrics.width/t,e.push({el:this,css:{height:n*i+"px",width:r.metrics.width+"px"}}))}),t.each(e,function(e){n(e.el).css(e.css)})},onTouchEnd:function(e){e.preventDefault()},onTap:function(e){this.enterFullscreen(e.currentTarget)},onGestureStart:function(e){var t=this.transition;if(this.gestureStarted||t.isRunning())return!1;this.gestureStarted=!0,t.setTargetEl(e.currentTarget),this.startTransform(e)},onGestureChange:function(e){var t=this.transition;if(t.isRunning())return!1;this.transformEventTarget(e)},onGestureEnd:function(e){var t=this.transition;if(t.isRunning())return!1;t.run(),this.gestureStarted=!1}}),l}),define("modules/layout/Block",["require","underscore","modules/dom","modules/BaseView","modules/layout/mixins/LayoutElement","modules/classnames"],function(e){var t=e("underscore"),n=e("modules/dom"),r=e("modules/BaseView"),i=e("modules/layout/mixins/LayoutElement"),s=e("modules/classnames"),o=r.extend();return t.extend(o.prototype,i,{tagName:"p",initialize:function(e){e=e||{},this.isOverflow=!1,this.isDirty=!1,this.originalMetrics=null,e.metrics||this.defaultMetrics()},render:function(){if(this.isRendered)return this;if(this.isOverflow){var e=n('<div style="overflow:hidden;margin:0;padding:0;"></div>');e.addClass(s.IS_BREAKABLE).addClass(s.IS_NON_REARRANGEABLE).append(this.el),this.setElement(e[0]),this.isDirty=!0}return this.isRendered=!0,this},clone:function(){var e=this,n=new o({el:this.el.cloneNode(!0)});return n.clonedFrom=this,n.metrics=t.extend({},this.metrics),this.isDirty&&n.$el.removeAttr("style"),n},revert:function(){this.isDirty&&(this.el.style.removeProperty("overflow"),this.el.style.removeProperty("height"),this.isDirty=!1)},isBreakable:function(){return this.$el.hasClass(s.IS_NON_BREAKABLE)?!1:this.$el.hasClass(s.IS_BREAKABLE)||["P","UL","OL"].indexOf(this.el.tagName)!==-1},isRearrangeable:function(){return this.$el.hasClass(s.IS_NON_REARRANGEABLE)?!1:this.$el.hasClass(s.IS_REARRANGEABLE)||["DIV"].indexOf(this.el.tagName)!==-1},shouldStickToNext:function(){return this.$el.hasClass(s.STICK_TO_NEXT)||["H1","H2","H3"].indexOf(this.el.tagName)!==-1},getOverflowBlock:function(e){var t=this.metrics.height,n=0,r,i;return i=this.clone(),i.isOverflow=!0,r=e%this.metrics.lineHeight,n=e-r,this.$el.css({overflow:"hidden",height:n+"px"}),this.isDirty=!0,i.$el.css("margin-top",this.metrics.marginTop-n+"px"),i.metrics.height-=n,i.metrics.outerHeight-=n,i.metrics.marginTop-=n,i}}),o}),define("modules/layout/Region",["require","underscore","modules/BaseView","modules/layout/mixins/LayoutElement","modules/layout/ContentRetainer","modules/layout/Container","modules/layout/Figure","modules/layout/Block","modules/util","modules/classnames"],function(e){var t=e("underscore"),n=e("modules/BaseView"),r=e("modules/layout/mixins/LayoutElement"),i=e("modules/layout/ContentRetainer"),s=e("modules/layout/Container"),o=e("modules/layout/Figure"),u=e("modules/layout/Block"),a=e("modules/util"),f=e("modules/classnames"),l=n.extend();return t.extend(l.prototype,r,i,{className:f.REGION,initialize:function(e){e=e||{},this.defaultMetrics(e.metrics),this.metrics.contentHeight=0,this.fragment=null,this._contentContainers=[],e.elements&&this.addElements(e.elements)},tearDown:function(){this.el=null,this.fragment=null,this.revert()},clone:function(){var e=new l({el:this.el.cloneNode(!0)});return e.content=this.content,e},setElement:function(e){l.__super__.setElement.call(this,e),this.isFlexible=this.$el.hasClass(f.REGION_FLEXIBLE),this._originalContainers=this._getInlineContainers(),this.containers=this._originalContainers.slice(0)},setContent:function(e){this.content=e,this.addElements(e.getElements())},addElements:function(e){return this.$el.empty(),this.fragment=document.createDocumentFragment(),t.forEach(e,this._addElement,this),this.el.appendChild(this.fragment),this.containers=this._contentContainers,this._contentContainers=[],this},getOverflow:function(e){return e=e||0,this.metrics.contentHeight-this.metrics.height+e},hasSpaceLeft:function(){return this.getOverflow()<0},revert:function(){t.invoke(this.elements,"revert"),this.metrics.contentHeight=0,this.lastUsedElement=null,this.releaseAll(),this.$el.empty()},_addElement:function(e){var t,n;return e=this._verifyElementIsUsable(e),!e||!this.isFlexible&&this.metrics.height===0?!0:(n=this.getOverflow(e.metrics.outerHeight),this.isFlexible||n*-1>this.metrics.lineHeight?(this._useElement(e),!0):n>-this.metrics.lineHeight&&n<=e.metrics.marginHeight?(e.shouldStickToNext()||this._useElement(e),!1):this._overflowElementIfSupported(e))},_useElement:function(e){this.metrics.contentHeight+=e.metrics.outerHeight,this.fragment.appendChild(e.render().el),this.retain(e.figure||e),this.lastUsedElement=e,e instanceof s&&this._contentContainers.push(e)},_overflowElementIfSupported:function(e){var t,n,r=e.isRearrangeable();return!r&&!e.isBreakable()?!1:r?(this.anchoredBlock=e,!0):(t=this.metrics.height-this.metrics.contentHeight,this._useElement(e),n=e.getOverflowBlock(t).render(),this.content.addAfter(n,this.anchoredBlock||this.lastUsedElement),this.anchoredBlock=null,!1)},_verifyElementIsUsable:function(e){if(e instanceof u)return e;if(e instanceof o&&!this._originalContainers)return!1;var n,r;return t.each(this._originalContainers,function(t){n=e.getElementMappedToField(t.fieldMap);if(n)return r=t,!1}),n?(r=r.clone(),r.setFigure(e,n),this.$el.append(r.render().el),r.calculateMetrics(),r.metrics.lineHeight=this.metrics.lineHeight,r.normalize(),r.$el.remove(),r):!1},_getInlineContainers:function(){return this.$el.find("."+f.CONTAINER_INLINE).map(function(){return new s({el:this})})}}),l}),define("modules/layout/FullscreenContainer",["require","underscore","modules/dom","modules/BaseView","modules/layout/mixins/LayoutElement","./Container","modules/util","modules/hub","when"],function(e){var t=e("underscore"),n=e("modules/dom"),r=e("modules/BaseView"),i=e("modules/layout/mixins/LayoutElement"),s=e("./Container"),o=e("modules/util"),u=e("modules/hub"),a=e("when"),f=r.extend();return t.extend(f.prototype,i,{initialize:function(){this.layer=this.options.layer||null},tearDown:function(){this.stopListening(),this.$el.remove()},subscribeToContainer:function(e){var t;!e.fullscreenEl&&e.figure&&(t=this.getFullscreenElement(e.figure),t&&e.setFullscreenEl(t)),this.listenTo(e,{fullscreenWillAppear:function(t,n){this._loadMathchingWidgetsForContainer(e,n)}})},getFullscreenElement:function(e){var t=o.dom.getFieldMap(this.el),n=e.getElementMappedToField(t),r;return n?n.cloneNode(!0):null},loadContainer:function(e,t){if(!this.layer){o.console.warn("No fullscreen layer found");return}var n=this,r,i=function(){e.fullscreenLoaded=!0,t()};this.$el.empty().append(e.fullscreenEl).css("display","block"),this.layer.render(this.el);if(e.fullscreenLoaded)return i();r=this.layer.$el.find("img[data-src]"),r.length||i(),r.each(function(){this.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",this.addEventListener("load",i),this.src=this.getAttribute("data-src")})},exitFullscreen:function(){this.layer.exitFullscreen()},_loadMathchingWidgetsForContainer:function(e,n){var r=[],i=[],s;s=function(){u.trigger("fullscreenWillAppear",e),n()};if(!e.matchingWidgets||!e.matchingWidgets.length)return this.loadContainer(e,s);r.push(a.defer()),this.loadContainer(e,r[0].resolve),t.each(e.matchingWidgets,function(e){var t=a.defer();r.push(t),e.widget.fullscreen.call(e,this,t.resolve)},this),a.all(r,s)}}),f}),function(e,t,n){var r=function(n){var r;this.options=t.extend({prefix:""},n),this.el=n.el,this.height=n.height||t(this.el).height(),this.lineHeight=n.lineHeight||0,r=e.getComputedStyle(this.el,null),this.paddingTop=parseInt(r.getPropertyValue("padding-top"),10),this.paddingBottom=parseInt(r.getPropertyValue("padding-bottom"),10),this.height-=this.paddingTop+this.paddingBottom,this._position()};r.prototype._position=function(){var e=this,n=[],r=this.el.className.match(/cols\-([0-9]+)/);if(!r)throw new Error("Failed to find number of columns");r=parseInt(r[1],10);for(var i=0;i<r;i++)n[i]={remainingHeight:this.height,cells:[]};t(this.el).find('[class*="col-"]').each(function(){var t=parseInt(this.className.match(/col\-([0-9]+)/)[1],10)-1,r=this.className.match(/colspan\-([0-9]+)/),i=e._createCellFromEl(this);r=r?parseInt(r[1],10):1;for(var s=t;s<t+r;s++)n[s].cells.push(i)}),this._calcMetrics(n),t.each(n,function(t,n){e._positionColumn(t,n)})},r.prototype._createCellFromEl=function(e){var n=t(e).hasClass(this._class("flex"));return{el:e,height:0,top:0,flex:n}},r.prototype._calcMetrics=function(e){var n,r,i,s,o,u,a,f,l;n=this._class("col-top"),r=this._class("col-bottom"),i=e.length;for(f=0;f<i;f++){s=e[f].cells.length;for(l=0;l<s;l++)u=e[f].cells[l],a=t(u.el),a.removeClass(n+" "+r),l===0&&(u.isTop=!0,a.addClass(n)),l===s-1&&(u.isBottom=!0,a.addClass(r))}for(f=0;f<i;f++){s=e[f].cells.length;for(l=0;l<s;l++)a=t(e[f].cells[l].el),o=a.hasClass(this._class("flex"))?0:a.outerHeight(),e[f].cells[l].height=o,e[f].remainingHeight-=o}},r.prototype._positionColumn=function(e,n){var r=this,i=this.paddingTop;t.each(n.cells,function(e,s){var o=t(s.el),u={},a=0;r.lineHeight&&!s.isTop&&(!s.isBottom||!!s.flex)&&(a=(i-r.paddingTop)%r.lineHeight,a!==0&&(a=r.lineHeight-a,n.remainingHeight-=a,i+=a));if(!s.isTop||s.top<i)s.top=i;u.top=s.top+"px";if(s.flex){var f=parseInt(o.css("margin-bottom"),10)+parseInt(o.css("margin-top"),10);s.height=n.remainingHeight,u.height=(s.height>f?s.height-f:0)+"px"}o.css(u),i+=s.height})},r.prototype._class=function(e){return this.options.prefix+e},t.fn.grid=function(e){return e=e||{},e.el=this[0],new r(e)},e.Grid=r}(this,window.Zepto||window.jQuery),define("grid",["modules/dom"],function(e){return function(){return e.window.Grid}}(this)),define("modules/layout/PageTemplate",["require","modules/dom","underscore","when","modules/BaseView","modules/layout/mixins/LayoutElement","modules/layout/Region","modules/layout/Block","modules/layout/Container","modules/layout/FullscreenContainer","modules/layout/ContentRetainer","modules/classnames","modules/util","grid","modules/hub"],function(e){var t=e("modules/dom"),n=e("underscore"),r=e("when"),i=e("modules/BaseView"),s=e("modules/layout/mixins/LayoutElement"),o=e("modules/layout/Region"),u=e("modules/layout/Block"),a=e("modules/layout/Container"),f=e("modules/layout/FullscreenContainer"),l=e("modules/layout/ContentRetainer"),c=e("modules/classnames"),h=e("modules/util"),p=e("grid"),d=e("modules/hub"),v=i.extend();return n.extend(v.prototype,s,l,{initialize:function(e){e.page&&this.setPage(e.page),this.template=e.template||null,this.deferreds=[],this.fullscreenContainer=this._getFullscreenContainer()},tearDown:function(){this.releaseAll(),this.stopListening(),n.invoke(this.containers,"tearDown"),n.invoke(this.regions,"tearDown"),this.template=null,this.containers=null,this.regions=null,this.fullscreenContainer&&this.fullscreenContainer.tearDown()},setElement:function(e){v.__super__.setElement.call(this,e),this.isPositionedGrid=!!this.el.className.match(/cols\-([0-9])+/),this.isResponsive=this.$el.hasClass(c.IS_RESPONSIVE),this.containers=this.$el.find("."+c.CONTAINER).map(function(){return new a({el:this})}),this.regions=this.$el.find("."+c.REGION).map(function(){return new o({el:this})})},setPage:function(e){this.page=e,this.content=e.content},prepareToRender:function(){this._setupContainersFromMap(),this._renderContainers()},render:function(){return this.loadContainers(),this._fit(),this._fillRegions(),this.trackProgress(),this},prepareToReflow:function(){n.invoke(this.regions,"revert")},reflow:function(){this._fit(),this._fillRegions()},decompile:function(){this.decompiled=!0,this.loadContainers(!0,this._getAllContainers()),this.trackProgress()},addDeferred:function(e){this.deferreds.push(e)},didRetainElements:function(){var e=l.didRetainElements.call(this);return e?!0:(n.each(this.regions,function(t){if(t.didRetainElements())return e=!0,!1}),e)},loadContainers:function(e,t){var r=this.deferreds;return t=t||this.containers,n.each(t,function(t){this._prepareContainerForLoad(t,e),t.load(),r=r.concat(t.deferreds)},this),this},trackProgress:function(){var e=this.page,t=function(){e.trigger("loadComplete",e),d.trigger("loadComplete",e)};this.deferreds.length?r.all(this.deferreds,t):t()},_getAllContainers:function(){var e=n.flatten(n.pluck(this.regions,"containers"));return e.concat(this.containers)},_setupContainersFromMap:function(){var e=this.containers,t=this.page.figures,r=this.fullscreenContainer,i;this.containers=n.map(this.page.containerMap.positions,function(n,r){var i,s,o;return s=e[r],n.match===!1?(n.isOptional&&s.remove(),!1):(o=t[n.index],s.setFigure(o,o.getElementMappedToField(n.fieldMap)),s)},this),this.containers=n.filter(this.containers)},_getFullscreenContainer:function(){var e=this.$el.find("."+c.CONTAINER_FULLSCREEN)[0];return e&&new f({el:e.cloneNode(!0),page:this,layer:this.page?this.page.fullscreenLayer:!1})},_fit:function(){var e=this.page.metrics;this.isPositionedGrid&&this.$el.grid({lineHeight:e.lineHeight,prefix:"alf-"}),n.each(this.regions,function(t){this.isPositionedGrid&&(t.metrics=t.$el.metrics(),t.metrics.contentHeight=0),t.metrics.lineHeight=e.lineHeight},this)},_renderContainers:function(){var e=this.page.content;return n.each(this.containers,function(e){e.render(),this.retain(e.figure)},this),this},_prepareContainerForLoad:function(e,t){var r,i;r=this.page.widgets,i=this.fullscreenContainer,e.page=this.page,e.setLayer(this.page.layer),e.matchingWidgets=r.getMatchesForContainer(e),e.options.pixelRatio=this.page.options.pixelRatio,n.each(e.matchingWidgets,function(t){if(!this.decompiled||this.decompiled&&!t.widget.compile)t.widget.render.call(t,this,t.el),t.widget.compile||(e.isDirty=!0)},this),e.unload(),t||(e.metrics=e.$el.metrics(),e.metrics.lineHeight=this.metrics.lineHeight,this.isResponsive||e.normalize()),i&&i.subscribeToContainer(e)},_fillRegions:function(){var e=this.page.content,t=e.getBlocks(),n=[],r=0,i=this.regions[r];while(i){i.setContent(e),i.containers.length&&(n=n.concat(i.containers));if(!e.hasBlocksLeft())break;i=this.regions[++r]||!1}this.loadContainers(!0,n)}}),v}),define("modules/compile/Container",["require","underscore","modules/dom","modules/Base","modules/layout/PageTemplate","modules/classnames"],function(e){var t=e("underscore"),n=e("modules/dom"),r=e("modules/Base"),i=e("modules/layout/PageTemplate"),s=e("modules/classnames"),o=r.extend({initialize:function(e){this.container=e,this.compiled={}},compile:function(){var e,t;return e=this.container,t=n(e.el.outerHTML),e.isDirty&&e.revert(),e.unload(t),this.compiled={loaded:e.loaded,metrics:e.metrics,html:t[0].outerHTML},e.fullscreenEl&&(this.compiled.fullscreenEl=e.fullscreenEl.outerHTML),this.compiled},decompile:function(e){var r=this.container;r.decompiled=!0,t.extend(r,e),r.fullscreenEl&&r.setFullscreenEl(n(r.fullscreenEl).get(0))}});return o}),define("modules/compile/Page",["require","underscore","modules/dom","modules/Base","modules/layout/PageTemplate","modules/classnames","modules/compile/Container","when"],function(e){var t=e("underscore"),n=e("modules/dom"),r=e("modules/Base"),i=e("modules/layout/PageTemplate"),s=e("modules/classnames"),o=e("modules/compile/Container"),u=e("when"),a=r.extend({initialize:function(e){t.bindAll(this,"_doDecompile"),this.page=e,this.compiled={v:1,elements:{},assets:{images:[]}}},compile:function(){var e;return this.page.lockSize(),this.compiled.html=this._getCompiledHtml(),this._compileImages(),this._compileStylesheets(),this.compiled},decompile:function(e,r){var s,o;r=r||function(){},this.page.decompiled=!0,this.compiledObject=t.isObject(e)?e:JSON.parse(e),o=n(this.compiledObject.html).get(0),this.page.pageTemplate=new i({el:o,page:this.page}),this.page.setElement(o),this.promises=this.page._loadStylesheets(this.compiledObject.assets.stylesheets),u.all(this.promises).then(this._doDecompile).then(r)},_doDecompile:function(){this.page.containers=this.page.pageTemplate.containers,this.page.regions=this.page.pageTemplate.regions,t.each(this.page.pageTemplate._getAllContainers(),function(e){this.page.layer&&e.setLayer(this.page.layer),this._decompileContainer(e,this.compiledObject.elements[e.id])},this)},_decompileContainer:function(e,t){(new o(e)).decompile(t)},_getCompiledHtml:function(){var e,r,i,s;return e=n(this.page.el.outerHTML),r=this.compiled,i=this.page.pageTemplate._getAllContainers(),t.each(i,function(i){var u=(new o(i)).compile();r.elements[i.id]=u,i.fullscreenEl&&(s=n(i.fullscreenEl).find("img[data-src]"),s.length>0&&(r.assets.images=r.assets.images.concat(t.toArray(s)))),e.find("#"+i.id).replaceWith(u.html),delete u.html}),e[0].outerHTML},_compileImages:function(){var e,n=this.compiled;e=this.page.$("img[data-src]"),e.length>0&&(n.assets.images=n.assets.images.concat(t.toArray(e))),n.assets.images=t.map(n.assets.images,this._compileImageAsset,this)},_compileImageAsset:function(e){var t=n(e),r={},i=t.attr("data-src-2x");return r["1x"]=t.attr("data-src"),i&&(r["2x"]=i),{height:parseInt(t.attr("height"),10),width:parseInt(t.attr("width"),10),urls:r}},_compileStylesheets:function(){this.compiled.assets.stylesheets=n("."+s.ASSET_STYLESHEET).map(function(){return this.href})}});return a}),define("modules/layout/Template",["require","modules/dom","underscore","modules/BaseView","./Region","./Container","./Figure","./PageTemplate","modules/util","modules/classnames"],function(e){var t=e("modules/dom"),n=e("underscore"),r=e("modules/BaseView"),i=e("./Region"),s=e("./Container"),o=e("./Figure"),u=e("./PageTemplate"),a=e("modules/util"),f=e("modules/classnames"),l={EMPTY_CONTAINER:-500,MATCHING_CONTAINER:100,EQUAL_CONTAINERS_FIGURES:100,NON_MATCHING_OPTIONAL_ELEMENT:-25,EMPTY_REGIONS:-500,MATCHING_REGION:100},c=r.extend();return n.extend(c.prototype,{setElement:function(e){c.__super__.setElement.call(this,e),this.name=this.$el.attr("data-name"),this.containers=this.$el.find("."+f.CONTAINER).map(function(){return new s({el:this})}),this.regions=this.$el.find("."+f.REGION).map(function(){return new i({el:this})}),this.baseScore=parseInt(this.$el.attr("data-score")||0,10)},score:function(e,t){var n=this.el.getAttribute("data-name"),r=this.baseScore,i=e.content.getBlocks(),s=e.figures,o=0;return t=t||this.getContainerMap(s),r+=t.score||0,s.length>0&&(r+=l.MATCHING_CONTAINER*t.matches),o=this.containers.length-t.matches,o>0&&(r+=l.EMPTY_CONTAINER*o),this.regions.length&&(r+=i.length?l.MATCHING_REGION:l.EMPTY_REGIONS),r},getContainerMap:function(e){var t={matches:0,positions:{},score:0},r=[],i,s,u;return i=e.getElements(),s=e.getFigures(),u=i.length,n.each(this.containers,function(e,n){var a,f,c;c=t.positions[n]={match:!1,fieldMap:e.fieldMap};for(a=0;a<u;a++){if(!(i[a]instanceof o&&r.indexOf(i[a])===-1))continue;f=i[a].getElementMappedToField(e.fieldMap);if(f){t.score-=a*5,t.matches+=1,r.push(i[a]),c.match=!0,c.index=s.indexOf(i[a]);return}}e.isOptional&&(t.score+=l.NON_MATCHING_OPTIONAL_ELEMENT,c.isOptional=!0)}),t},getPageTemplate:function(e){return new u(n.extend(e||{},{el:this.el.cloneNode(!0)}))}}),c}),define("modules/layout/filters/article",["require","underscore","modules/util"],function(e){var t=e("underscore"),n=e("modules/util"),r=!!n.matchMedia;return{mediaQuery:function(e,i){return r?t.filter(i,function(e){var t=n.dom.getMediaQuery(e.el);return t?n.matchMedia(t).matches:!0}):i},fieldMap:function(e,r){var i=e.content.fieldMap,s;return!i||!i.length?r:t.filter(r,function(e){return s=n.dom.getFieldMap(e.el),s.length?t.intersection(i,s).length>0:!1})},emptyContainers:function(e,n){var r;return r=function(e){return e.match===!0||e.match===!1&&e.isOptional},t.filter(n,function(n){var i=n.getContainerMap(e.content);return t.every(i.positions,r)})},formatName:function(e,n){var r;return!e.format||!(r=e.format.get("name"))?n:t.filter(n,function(e){var t=e.$el.attr("data-filter-format-name");return!t||t===r})}}}),define("modules/layout/filters/page",["require","underscore"],function(e){var t=e("underscore");return{emptyBlocks:function(e,n){return t.filter(n,function(r){var i=r.regions.length,s=e.content.getBlocks().length,o=!1;return t.each(r.regions,function(e){if(e.containers.length>0)return o=!0,!1}),o?n:i>0&&s===0?!1:r})},emptyContainers:function(e,n){var r;return r=function(e){return e.match===!0||e.match===!1&&e.isOptional},t.filter(n,function(n){var i=n.getContainerMap(e.content);return t.every(i.positions,r)})},pagePosition:function(e,n){return t.filter(n,function(n){var r=n.$el.attr("data-filter-page-pos"),i=e.pageNum+1,s=!1;return r?(r=r.split(" "),t.each(r,function(e){var t=!1,n=parseInt(e,10);e[0]==="!"&&(t=!0,n=parseInt(e.substr(1),10));if(t&&n!==i||!t&&n===i)return s=!0,!1}),s):!0})}}}),define("modules/layout/TemplateManager",["require","underscore","./Template","./filters/article","./filters/page"],function(e){var t=e("underscore"),n=e("./Template"),r=e("./filters/article"),i=e("./filters/page"),s={filters:{article:t.values(r),page:t.values(i)},addArticleFilter:function(e){this.filters.article.push(e)},addPageFilter:function(e){this.filters.page.push(e)},getBestTemplateForPage:function(e,n){var r,i,s={score:-Infinity,template:null,containerMap:null};return t.each(n,function(t){r=t.getContainerMap(e.content),i=t.score(e,r),i>s.score&&(s.score=i,s.template=t,s.containerMap=r)}),s},getEligibleTemplatesForArticle:function(e,t){return this._filterTemplates("article",e,t)},getEligibleTemplatesForPage:function(e,t){return this._filterTemplates("page",e,t)},_filterTemplates:function(e,n,r){return t.each(this.filters[e],function(e){r=e.call(this,n,r)},this),r}};return s}),define("modules/layout/Page",["require","modules/dom","underscore","modules/BaseView","modules/layout/Format","modules/layout/Figure","modules/compile/Page","modules/layout/PageTemplate","modules/layout/TemplateManager","modules/layout/mixins/LayoutElement","modules/layout/mixins/Widgetable","modules/classnames","modules/util","when"],function(e){var t=e("modules/dom"),n=e("underscore"),r=e("modules/BaseView"),i=e("modules/layout/Format"),s=e("modules/layout/Figure"),o=e("modules/compile/Page"),u=e("modules/layout/PageTemplate"),a=e("modules/layout/TemplateManager"),f=e("modules/layout/mixins/LayoutElement"),l=e("modules/layout/mixins/Widgetable"),c=e("modules/classnames"),h=e("modules/util"),p=e("when"),d=r.extend();return n.extend(d.prototype,f,l,{className:"page",initialize:function(){var e=this.options||(this.options={});n.bindAll(this,"render"),this.decompiled=!1,this.pageNum=typeof e.pageNum=="number"?e.pageNum:null,this.className=e.className||"",this.content=e.content||null,this.figures=null,this.layer=e.layer||null,this.fullscreenLayer=e.fullscreenLayer||this.layer&&this.layer.above()||null,this.templateManager=e.templateManager||a,this.format=e.format||null,e.pixelRatio=parseInt(e.pixelRatio||window.devicePixelRatio||1,10),this.defaultMetrics(e.metrics),this.setupWidgets(e)},tearDown:function(){this.el=null,this.pageTemplate&&this.pageTemplate.tearDown(),this.pageTemplate=null,this.content=null,this.figures=null,this.fullscreenLayer&&this.fullscreenLayer.hide()},restoreFromHtml:function(e){this.setElement(t(e)),this.setPageTemplate(new u({el:this.el.children[0]})),this.rendered=!0},setupBestTemplate:function(){var e;this.figures=this.content.getFigures(),e=this.templateManager.getBestTemplateForPage(this,this.templates);if(!e.template){h.console.warn("No template found for page! Remaining elements: "+this.content.elementsLeft);return}this.setTemplate(e.template,e.containerMap)},setTemplate:function(e,t){this.rendered=!1,this.figures=this.figures||this.content.getFigures(),this.containerMap=t||e.getContainerMap(this.content),this.template=e,this.setPageTemplate(e.getPageTemplate({page:this}))},setPageTemplate:function(e){this.pageTemplate=e,this.$el.empty(),this.$el.append(this.pageTemplate.el),this.containers=this.pageTemplate.containers,this.regions=this.pageTemplate.regions},prepareToRender:function(){if(this.rendered||!this.template)return this;this.className&&this.$el.addClass(this.className),this.pageTemplate.prepareToRender()},render:function(e){var t=this,n;return!this.rendered&&this.decompiled?(e&&this._appendToEl(e),this.pageTemplate.decompile(),this.rendered=!0,this):this.rendered||!this.template?this:(this._setupMetrics(),this.pageTemplate.render(),this.rendered=!0,e&&this._appendToEl(e),this)},play:function(){this.$el.addClass(c.IS_PLAYING)},stop:function(){this.$el.removeClass(c.IS_PLAYING)},prepareToReflow:function(){this.pageTemplate.prepareToReflow()},reflow:function(){this.pageTemplate.reflow()},lockSize:function(){if(this.pageTemplate.isResponsive)return;this.$el.css({width:this.metrics.width+"px",height:this.metrics.height+"px",overflow:"hidden",position:"relative"})},compile:function(){var e=new o(this);return e.compile()},decompile:function(e,t){var n=new o(this);return n.decompile(e,t),this},_appendToEl:function(e){var n=this.el;setTimeout(function(){t(e).empty().append(n)},0)},_setupMetrics:function(){var e=this.$el.metrics();this.format&&this.format instanceof i&&(e.height=this.format.get("height"),e.width=this.format.get("width")),e.lineHeight=this.metrics.lineHeight,!e.height&&this.metrics.height&&(e.height=this.metrics.height,e.outerHeight=this.metrics.outerHeight),this.metrics=e,this.pageTemplate.metrics=e,e.contentHeight=e.height-e.marginHeight-e.paddingTop-e.paddingBottom,e.contentWidth=e.width-e.marginWidth-e.paddingRight-e.paddingLeft},_loadStylesheets:function(e){e=n.map(e,function(e){return e.indexOf("://")===-1?this.options.assetsBaseUrl+e:e},this);var r=t("."+c.ASSET_STYLESHEET),i=[],s;return n.each(r,function(n){var r=t(n),i=e.indexOf(r.attr("href"));if(i!==-1){e.splice(i,1);return}e.length?(s=e.shift(),r.attr("href",s),this._trackStylesheetProgress(s)):r.remove()},this),n.each(e,function(e){var n=t('<link rel="stylesheet" type="text/css" class="'+c.ASSET_STYLESHEET+'">');t("head").append(n.attr("href",e)),i.push(this._trackStylesheetProgress(e))},this),i},_trackStylesheetProgress:function(e){var t,n;t=p.defer(),n=document.createElement("img"),this.pageTemplate.addDeferred(t),n.onerror=function(){t.resolve()},n.src=e}}),d}),define("modules/compile/Article",["require","underscore","modules/dom","modules/Base","modules/layout/Page","modules/classnames"],function(e){var t=e("underscore"),n=e("modules/dom"),r=e("modules/Base"),i=e("modules/layout/Page"),s=e("modules/classnames"),o=r.extend({initialize:function(e){this.article=e,this.compiled={}},compile:function(){var e=this.article.content.toJSON(),r;return e.meta.articleId=e.meta.articleId||e.meta.id,delete e.meta.id,r=n("."+s.ASSET_STYLESHEET).map(function(){return this.href}),e.compiled={},e.compiled.pages=t.map(this.article.pages,function(e){return e.compile()}),e.compiled.assets={stylesheets:r},e},decompile:function(e){var n=t.isObject(e)?e:JSON.parse(e);this.article.pages=t.map(n.pages,function(e){var t=new i;return t.decompile(e),t})}});return o}),define("modules/layout/Content",["require","underscore","modules/dom","modules/util","modules/BaseModel","./Block","./Figure"],function(e){function t(e){return function(t){return t instanceof e}}var n=e("underscore"),r=e("modules/dom"),i=e("modules/util"),s=e("modules/BaseModel"),o=e("./Block"),u=e("./Figure"),a=s.extend({defaults:{contents:{},meta:{}},initialize:function(e){var t,n;e&&e.contents&&this._changeContents(),this.on("change:contents",this._changeContents),this.__defineGetter__("elementsLeft",this._getElementsLeft)},setElements:function(e){e=n.filter(e,function(e){return e.tagName==="P"&&e.innerHTML.length<10&&!e.innerHTML.replace(/^(\s+)?(<br(\s+)?\/?>)?(\s+)?$/i,"")?!1:e}),this.elements=n.map(e,function(e){var t={el:e},n;return e.tagName==="FIGURE"?n=new u(t):n=new o(t),n})},addAfter:function(e,t){var n=this.elements;n.splice(n.indexOf(t)+1,0,e)},each:function(e,t){n.each(this.elements,e,t||this)},release:function(e){e=n.isArray(e)?e:[e],n.each(e,function(e,t){e.retained=!1,e.clonedFrom&&!e.clonedFrom.retained?this.elements.splice(this.elements.indexOf(e),1):e.revert&&e.revert()},this)},releaseAll:function(){this.release(this.elements)},retain:function(e){var t=this.elements,r=n.isArray(e)?e:[e];n.each(r,function(e){e.retained=!0})},retainAll:function(){n.each(this.elements,function(e){e.retained=!0})},getElements:function(){return n.filter(this.elements,function(e){return!e.retained})},getBlocks:function(){return n.filter(this.elements,function(e){return!e.retained&&e instanceof o})},getFigures:function(e){return e=e||Infinity,n.filter(this.elements,function(n,r){return r>e?!1:!n.retained&&n instanceof u})},hasBlocksLeft:function(){return this.getBlocks().length>0},isEmpty:function(){return this.elementsLeft===0},_changeContents:function(){var e,t;e=r(this.get("contents").source),t=e.children(),this.className=e.attr("class"),this.fieldMap=i.dom.getFieldMap(e[0]),this.setElements(t)},_getElementsLeft:function(){return n.reduce(this.elements,function(e,t){return t.retained?e:e+1},0)}});return a}),define("modules/layout/Article",["require","modules/dom","underscore","modules/util","modules/BaseView","modules/layout/mixins/Widgetable","modules/layout/mixins/LayoutElement","modules/compile/Article","modules/layout/Format","modules/layout/TemplateManager","modules/layout/Page","modules/layout/Content"],function(e){var t=e("modules/dom"),n=e("underscore"),r=e("modules/util"),i=e("modules/BaseView"),s=e("modules/layout/mixins/Widgetable"),o=e("modules/layout/mixins/LayoutElement"),u=e("modules/compile/Article"),a=e("modules/layout/Format"),f=e("modules/layout/TemplateManager"),l=e("modules/layout/Page"),c=e("modules/layout/Content"),h=i.extend();return n.extend(h.prototype,o,s,{initialize:function(){var e=this.options||(this.options={});n.bindAll(this,"render"),this.templates=null,this.overrideTemplates={},this.layer=e.layer||null,this.fullscreenLayer=e.fullscreenLayer||this.layer&&this.layer.above()||null,this.pages={},this.numberOfPages=0,this.format=e.format||null,this.defaultMetrics(e.metrics),this.setContent(e.content),this.setupWidgets(e),e.templates&&this.setTemplates(e.templates)},tearDown:function(){n.invoke(this.pages,"tearDown")},render:function(){return this},compile:function(){var e=new u(this);return e.compile()},decompile:function(e){var t=new u(this);return t.decompile(e),this},setTemplates:function(e){this.templates=f.getEligibleTemplatesForArticle(this,e)},setTemplateForPageNum:function(e,t){var n={},r=0;this.overrideTemplates[t]=e;for(var i=0;i<this.numberOfPages;i++){if(!this.pages[i])continue;i<t?(n[i]=this.pages[i],r++):(this.pages[i].tearDown(),this.pages[i]=null)}this.pages=n,this.numberOfPages=r},reflow:function(e){var t={},n=0;for(var r=0;r<this.numberOfPages;r++){if(!this.pages[r])continue;r<=e?(r===e&&this.pages[r].prepareToReflow(),t[r]=this.pages[r],n++):(this.pages[r].tearDown(),this.pages[r]=null)}this.pages[e].reflow(),this.pages=t,this.numberOfPages=n},renderPage:function(e,r){this._calcContentMetrics(e);var i=n.isObject(r)?r:this.getOrCreatePageForPageNum(e,r);return i.prepareToRender(),t(e).empty().append(i.el),i.render(),i},renderPages:function(e,t){t=t||0,this._calcContentMetrics(e);while(!this.content.isEmpty()){if(!this._doRenderPage(e,t))break;t+=1}return this},getOrCreatePageForPageNum:function(e,t){var n=this.pages[t],r=this.overrideTemplates[t],i;return n&&(!r||r===n.template)?n:(i=this.metrics,n=new l({className:this.content.className,content:this.content,layer:this.layer,fullscreenLayer:this.fullscreenLayer,widgets:this.widgets,fullscreenWidgets:this.fullscreenWidgets,pageNum:t,format:this.format,metrics:{height:i.height,width:i.width,lineHeight:i.lineHeight}}),n.templates=f.getEligibleTemplatesForPage(n,this.templates.slice(0)),r?n.setTemplate(r):n.setupBestTemplate(),n.pageTemplate?(this.pages[t]=n,this.numberOfPages+=1,n):!1)},removePage:function(e,t){if(!this.pages[t])return;e.pageTemplate&&e.pageTemplate.releaseAll(),delete this.pages[t],this.numberOfPages-=1},setContent:function(e){if(e instanceof c)this.content=e;else{if(!n.isPlainObject(e))throw new Error("Unsupported data in setContent: "+typeof e);this.content=new c(e)}},_doRenderPage:function(e,t){var n=0,i,s;for(;;){i=this.getOrCreatePageForPageNum(e,t);if(!i)return!1;this.renderPage(e,i);if(i.pageTemplate.didRetainElements())return!0;r.console.warn("Page "+t+" did not retain any elements on attempt "+n,"left:",this.content.elementsLeft),this.removePage(i,t),n+=1;if(n>1||!this.overrideTemplates[t])return r.console.warn("stopped trying after "+n+" attempts"),!1;this.overrideTemplates[t]=null}},_getSampleTemplate:function(){var e,t=0,r;return n.each(this.templates,function(i){r=i.regions,r&&r.length>t&&(e=i)}),e},_calcContentMetrics:function(e){if(this.hasCalculatedMetrics)return;this.setMetrics(t(e).metrics()),this.format&&this.format instanceof a&&(this.metrics.height=this.format.get("height"),this.metrics.width=this.format.get("width"));var n=this._getSampleTemplate(),i;if(!n){r.console.warn("No sample template found. Failed to precalculate metrics for ",this);return}n=n.getPageTemplate(),i=n.regions,n.$el.css("visibility","hidden"),e.appendChild(n.el),this._calcBlockMetrics(i[0].el),e.removeChild(n.el),i[0].$el.empty(),this.hasCalculatedMetrics=!0},_calcBlockMetrics:function(e){var t=this.content.getBlocks(),r=document.createDocumentFragment(),i=this.metrics;n.each(t,function(t){r.appendChild(t.render().el)}),e.appendChild(r),n.each(t,function(t){t.calculateMetrics(),t.metrics.lineHeight=i.lineHeight,t.normalize()})}}),h}),define("modules/layout",["require","./layout/Article","./layout/Page","./layout/Template","./layout/TemplateManager","./layout/Content","./layout/Format"],function(e){return{Article:e("./layout/Article"),Page:e("./layout/Page"),Template:e("./layout/Template"),TemplateManager:e("./layout/TemplateManager"),Content:e("./layout/Content"),Format:e("./layout/Format")}}),define("modules/nav",["require","./nav/ScrollView"],function(e){return{ScrollView:e("./nav/ScrollView")}}),define("alf",["require","modules/dom","underscore","modules/hub","modules/Base","modules/BaseView","vendor/queue","backbone","modules/transition","modules/layer","modules/layout","modules/nav","modules/util"],function(e){return{dom:e("modules/dom"),_:e("underscore"),hub:e("modules/hub"),Base:e("modules/Base"),View:e("modules/BaseView"),Queue:e("vendor/queue"),Events:e("backbone").Events,transition:e("modules/transition"),layer:e("modules/layer"),layout:e("modules/layout"),nav:e("modules/nav"),util:e("modules/util")}}),require(["require","requirejs","alf"],function(e,t,n){}),define("main",function(){})